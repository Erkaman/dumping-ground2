(function e$$0(t,B,c){function r(h,m){if(!B[h]){if(!t[h]){var b="function"==typeof require&&require;if(!m&&b)return b(h,!0);if(d)return d(h,!0);b=Error("Cannot find module '"+h+"'");throw b.code="MODULE_NOT_FOUND",b;}b=B[h]={exports:{}};t[h][0].call(b.exports,function(b){var c=t[h][1][b];return r(c?c:b)},b,b.exports,e$$0,t,B,c)}return B[h].exports}for(var d="function"==typeof require&&require,w=0;w<c.length;w++)r(c[w]);return r})({1:[function(k,t,B){function c(c){var d=(c&32768)>>15,m=(c&31744)>>
10;c&=1023;return 0===m?c/Math.pow(2,10)*Math.pow(2,-14)*(d?-1:1):31===m?c?NaN:Infinity*(d?-1:1):(d?-1:1)*Math.pow(2,m-15)*(1+c/Math.pow(2,10))}function r(d){var h=(new Int32Array(d,0,1))[0];d=new Int16Array(d.slice(4,4+2*h));for(var m=[],b=0;b<h;b++)m.push(c(d[b]));return m}var d=k("zeros");t.exports.cpuSoftmax=function(c){var h=c.shape[1],m,b=0;for(m=0;m<h;m++)b+=Math.exp(c.get(0,m));var r=d([1,h]);for(m=0;m<h;m++)r.set(0,m,Math.exp(c.get(0,m))/b);return r};t.exports.loadJson=function(c){k("resl")({manifest:{wConv1Json:{type:"binary",
src:"./w_conv1.bin",parser:r},bConv1Json:{type:"binary",src:"./b_conv1.bin",parser:r},wFc1Json:{type:"binary",src:"./w_fc1.bin",parser:r},bFc1Json:{type:"binary",src:"./b_fc1.bin",parser:r},wFc2Json:{type:"binary",src:"./w_fc2.bin",parser:r},bFc2Json:{type:"binary",src:"./b_fc2.bin",parser:r}},onDone:function(d){c(d)}})}},{resl:39,zeros:40}],2:[function(k,t,B){t=k("./common.js").loadJson;var c=document.body.appendChild(document.createElement("canvas"));c.width=1;c.height=1;var r=k("../regl")({canvas:c,
extensions:["oes_texture_float"],onDone:function(c,r){if(c)throw document.body.innerHTML="Failed to initialize the demo because:</br></br><code>"+c+"</code></br></br>",c;}});t(function(d){function w(b){var d=b.pageX-c.offsetLeft;b=b.pageY-c.offsetTop;p.beginPath();p.lineWidth=1;p.arc(d,b,l/2,0,2*Math.PI);p.stroke();p.closePath();p.fill()}function h(b,c){"down"===b?(n=!0,w(c)):"up"===b?n=!1:"move"===b&&n&&(w(c),c.preventDefault())}function m(b){for(var c=[],d=0;d<b.height;d++){c[d]=[];for(var h=0;h<
b.width;h++){var m=4*d*b.width+4*h;0===b.data[m+3]&&(b.data[m+0]=255,b.data[m+1]=255,b.data[m+2]=255);b.data[m+3]=255;c[d][h]=b.data[4*d*b.width+4*h+0]/255}}return c}var b=k("./gpu.js")(r,d);d=document.createElement("div");d.style.cssText="margin: 0 auto; max-width: 960px;";d.style.fontWeight="300";d.style.fontSize="1.0rem";d.style.fontFamily="'Roboto',Helvetica,sans-serif";d.style.color="#444444";document.body.appendChild(d);var A=document.createElement("h1");A.innerHTML="GPU Deep Learning Demo";
A.style.fontWeight="400";A.style.fontSize="2rem";d.appendChild(A);A=document.createElement("p");A.innerHTML="Please draw a character into this canvas.";d.appendChild(A);c=document.createElement("canvas");c.width=280;c.height=280;c.style.borderWidth=1;c.style.borderStyle="solid";d.appendChild(c);var p=c.getContext("2d"),A=document.createElement("div"),z=document.createElement("button");z.innerHTML="Clear";z.addEventListener("click",function(b){p.clearRect(0,0,c.width,c.height)},!1);A.appendChild(z);
z=document.createElement("button");z.innerHTML="Recognize";z.addEventListener("click",function(d){var h,l,n,u,r,w=p.getImageData(0,0,280,280);d=m(w);l=d.length;n=h=d[0].length;var f=l;u=r=-1;for(var a=0;a<l;a++)for(var e=0;e<h;e++).01>d[a][e]&&(n>e&&(n=e),r<e&&(r=e),f>a&&(f=a),u<a&&(u=a));l=f;h=e=0;for(var f=d.length,S=d[0].length,R=a=0;R<f;R++)for(var xa=0;xa<S;xa++){var N=1-d[R][xa],a=a+N;h+=R*N;e+=xa*N}d=Math.round(S/2-e/a);h=Math.round(f/2-h/a);f=document.createElement("canvas");f.width=w.width;
f.height=w.height;w=f.getContext("2d");n=r+1-n;l=u+1-l;l=190/(n>l?n:l);w.translate(c.width/2,c.height/2);w.scale(l,l);w.translate(-c.width/2,-c.height/2);w.translate(d,h);w.drawImage(p.canvas,0,0);w=w.getImageData(0,0,280,280);d=m(w);w=Array(784);for(l=0;28>l;l++)for(n=0;28>n;n++){for(r=u=0;10>r;r++)for(h=0;10>h;h++)u+=d[10*l+r][10*n+h];u=1-u/100;w[n+28*l]=u}d=b(w);console.log("result: ",d);d=d.indexOf(Math.max.apply(null,d));g.innerHTML=d+""},!1);A.appendChild(z);d.appendChild(A);var g=document.createElement("p");
g.innerHTML="";g.style.fontWeight="800";g.style.fontSize="4em";d.appendChild(g);c.addEventListener("mousemove",function(b){h("move",b)},!1);c.addEventListener("mousedown",function(b){h("down",b)},!1);c.addEventListener("touchstart",function(b){h("down",b)},!1);c.addEventListener("touchend",function(b){h("up",b)},!1);c.addEventListener("touchmove",function(b){h("move",b)},!1);c.addEventListener("mouseup",function(b){h("up",b)},!1);c.addEventListener("mouseout",function(b){h("out",b)},!1);var l=20,
n=!1})},{"../regl":41,"./common.js":1,"./gpu.js":3}],3:[function(k,t,B){var c=k("ndarray"),r=k("./common.js").cpuSoftmax;t.exports=function(d,w){function h(b,a){return d.texture({width:b,height:a,format:"rgba",type:"float",mag:"nearest",min:"nearest",wrap:"clamp"})}function m(b){var a=[];d({framebuffer:b})(function(){for(var b=d.read(),c=0;c<b.length;c+=4)a.push(b[c])});return c(a,[b.color[0].height,b.color[0].width])}function b(b,a){if(b.width!==a.height)throw Error("Impossible matrix mul!");var c=
h(a.width,b.height),e=g;e.frag=["precision mediump float;\nuniform sampler2D aTex;\nuniform sampler2D bTex;\nvarying vec2 vUv;","#define oDim vec2("+a.width+","+b.height+")","#define aDim vec2("+b.width+","+b.height+")","#define bDim vec2("+a.width+","+a.height+")","#define aDimi ivec2("+b.width+","+b.height+")","void main () {\n  vec2 uv = vUv;\n  float x = uv.x * oDim.x;\n  float y = uv.y * oDim.y;\n  float sum = 0.0;\n  for (int i = 0; i < aDimi.x; i++) {\n    float a = texture2D(aTex, vec2(float(i) / aDim.x, y / aDim.y)).x;\n    float b = texture2D(bTex, vec2(x / bDim.x, float(i) / bDim.y)).x;\n    sum += a*b;\n  }\ngl_FragColor = vec4(sum);\n}"].join("\n");
e.uniforms={aTex:d.prop("aTex"),bTex:d.prop("bTex")};var l=d(e);return{out:c,func:function(){var e=d.framebuffer({color:c});l({aTex:b,bTex:a,outFbo:e})}}}function k(b,a){if(b.width!==a.width||b.height!==a.height)throw Error("Impossible matrix add!");var c=h(b.width,b.height),e=g;e.frag="precision mediump float;\nuniform sampler2D aTex;\nuniform sampler2D bTex;\nvarying vec2 vUv;\nvoid main () {\n  float a = texture2D(aTex, vUv).x;\n  float b = texture2D(bTex, vUv).x;\n  float res = a + b;\ngl_FragColor = vec4(res);\n}";
e.uniforms={aTex:d.prop("aTex"),bTex:d.prop("bTex")};var l=d(e);return{out:c,func:function(){var e=d.framebuffer({color:c});l({aTex:b,bTex:a,outFbo:e})}}}function p(b,a){var c,e,h;if(3===a.length){for(var l=a[1]*a[2],S=[],m=0;m<a[0];m++){e=[];for(c=0;c<l;c++)h=b[l*m+c],e.push(h,h,h,h);c=d.texture({width:a[1],height:a[2],data:e,format:"rgba",type:"float",mag:"nearest",min:"nearest"});S.push(c)}return S}e=[];for(c=0;c<b.length;c++)h=b[c],e.push(h,h,h,h);return d.texture({width:a[1],height:a[0],data:e,
format:"rgba",type:"float",mag:"nearest",min:"nearest"})}function z(b){b=p(b,[28,28]);u.func(b);D.func();G.func();f.func();a.func();e.func();S.func();R.func();b=m(d.framebuffer({color:R.out}));b=r(b);return b.data}var g={vert:"precision mediump float;\nattribute vec2 position;\nvarying vec2 vUv;\nvoid main () {\n  vUv = 0.5 * (position + 1.0);\n  gl_Position = vec4(position, 0, 1);\n}",attributes:{position:[-4,-4,4,-4,0,4]},count:3,framebuffer:d.prop("outFbo")},l=p(w.wConv1Json,[16,5,5]),n=p(w.bConv1Json,
[1,16]),I=p(w.wFc1Json,[3136,64]),K=p(w.wFc2Json,[64,10]),F=p(w.bFc2Json,[1,10]),y=p(w.bFc1Json,[1,64]),u=function(b,a){for(var c=[],e=0;e<b.length;e++){var l=h(28,28);c.push(l)}e=g;e.frag=["precision mediump float;\nuniform sampler2D tex;\nuniform sampler2D kernel;\nuniform sampler2D bias;\nvarying vec2 vUv;\nuniform float i;","#define N float("+b.length+")","#define kRad int("+Math.floor(b[0].width/2)+")","#define kDim vec2("+b[0].width+","+b[0].height+")","#define tDim vec2(28,28)\nvoid main () {\n  vec2 tRcp = vec2(1.0 / tDim.x, 1.0 / tDim.y);\n  vec2 kRcp = vec2(1.0 / kDim.x, 1.0 / kDim.y);\n  vec2 uv = vUv;\n  float sum = 0.0;\n  for( int ir = -kRad; ir <= +kRad; ir++) {\n    for( int ic = -kRad; ic <= +kRad; ic++) {\n      vec2 tUv = uv + vec2(float(ic), float(ir)) * tRcp;\n      float a = texture2D(tex, tUv).x;\n      vec2 kUv = (vec2(float(ic), float(ir)) + vec2(float(kRad))) * kRcp;\n      kUv += kRcp * 0.5;\n      float b = texture2D(kernel, kUv).x;\n      float e = 0.01;\n      if(tUv.x < (0.0-e) || tUv.y < (0.0-e) || tUv.x > (1.0+e) || tUv.y > (1.0+e)) {\n        a = 0.0;\n      }\n      sum += a * b;\n    }\n  }\n  sum += texture2D(bias, vec2(i / N, 0.0)).x;\n  sum = max(sum, 0.0);\n  gl_FragColor = vec4(sum);\n}"].join("\n");
e.uniforms={tex:d.prop("tex"),kernel:d.prop("kernel"),bias:d.prop("bias"),i:d.prop("i")};var S=d(e);return{out:c,func:function(e){for(var h=d.framebuffer({}),l=0;l<b.length;l++)h({color:c[l]}),S({tex:e,kernel:b[l],bias:a,outFbo:h,i:l});return c}}}(l,n),D=function(b){for(var a=[],c=0;c<b.length;c++){var e=h(14,14);a.push(e)}c=g;c.frag=["precision mediump float;\nuniform sampler2D wTex;\nvarying vec2 vUv;","#define wDim vec2("+b[0].width+","+b[0].height+")","void main () {\n  vec2 wRcp = vec2(1.0 / wDim.x, 1.0 / wDim.y);\n  vec2 uv = vUv;\n  float a = texture2D(wTex, uv + wRcp * vec2(0.0, 0.0)).x;\n  float b = texture2D(wTex, uv + wRcp * vec2(1.0, 0.0)).x;\n  float c = texture2D(wTex, uv + wRcp * vec2(0.0, 1.0)).x;\n  float d = texture2D(wTex, uv + wRcp * vec2(1.0, 1.0)).x;\n  float res = max(max(a, b), max(c, d));\n  gl_FragColor = vec4(res);\n}"].join("\n");
c.uniforms={wTex:d.prop("tex")};var l=d(c);return{out:a,func:function(){for(var c=d.framebuffer({}),e=0;e<b.length;e++)c({color:a[e]}),l({tex:b[e],outFbo:c})}}}(u.out),G=function(b){var a=b.length*b[0].width*b[0].height,c=h(a,1),e=g;e.frag=["precision mediump float;\nuniform sampler2D wTex;\nvarying vec2 vUv;\nuniform float i;","#define oDim vec2("+a+",1)","#define wDim vec2("+b[0].width+","+b[0].height+")","#define wRcp vec2(1.0 / float("+b[0].width+"), 1.0 / float("+b[0].height+"))","#define wSize float("+
b[0].width+"*"+b[0].height+")","void main () {\n  vec2 uv = vUv;\n  float elem = uv.x * oDim.x;\n  if(((floor(elem / wSize)) - i) < 0.001) {\n    vec4 res = vec4(1.0);\n    elem = mod(elem, wSize);\n    float x = (mod(elem, wDim.x)) / wDim.x;\n    float y = (elem / wDim.x) / wDim.y;\n    res = vec4(texture2D(wTex, vec2(x,y) ).x);\n    gl_FragColor = vec4(res);\n  } else {\n    discard;\n  }\n}"].join("\n");e.uniforms={i:d.prop("i"),wTex:d.prop("tex")};var l=d(e);return{out:c,func:function(){for(var a=
d.framebuffer({color:c}),e=0;e<b.length;e++)l({tex:b[e],outFbo:a,i:e})}}}(D.out),f=b(G.out,I),a=k(f.out,y),e=function(b){var a=h(b.width,b.height),c=g;c.frag="precision mediump float;\nuniform sampler2D aTex;\nvarying vec2 vUv;\nvoid main () {\n  float a = texture2D(aTex, vUv).x;\n  float res = max(0.0, a);\n  gl_FragColor = vec4(res);\n}";c.uniforms={aTex:d.prop("aTex")};var e=d(c);return{out:a,func:function(){var c=d.framebuffer({color:a});e({aTex:b,outFbo:c});return a}}}(a.out),S=b(e.out,K),R=
k(S.out,F);z(Array.apply(null,Array(784)).map(Number.prototype.valueOf,0));return z}},{"./common.js":1,ndarray:38}],4:[function(k,t,B){function c(){this.w=this.z=this.y=this.x=this.state=0;this.buffer=null;this.size=0;this.normalized=!1;this.type=5126;this.divisor=this.stride=this.offset=0}t.exports=function(r,d,w,h,m){r=w.maxAttributes;d=Array(r);for(w=0;w<r;++w)d[w]=new c;return{Record:c,scope:{},state:d}}},{}],5:[function(k,t,B){function c(b){return z[Object.prototype.toString.call(b)]|0}function r(b,
c){for(var d=0;d<c.length;++d)b[d]=c[d]}function d(b,c,d,h,l,m,p){for(var f=0,a=0;a<d;++a)for(var e=0;e<h;++e)b[f++]=c[l*a+m*e+p]}function w(b,c,d){for(var h=0,l=0;l<c.length;++l)for(var m=c[l],p=0;p<d;++p)b[h++]=m[p]}var h=k("./util/check"),m=k("./util/is-typed-array"),b=k("./util/is-ndarray"),A=k("./util/values"),p=k("./util/pool"),z=k("./constants/arraytypes.json"),g=k("./constants/dtypes.json"),l=k("./constants/usage.json"),n=[];n[5120]=1;n[5122]=2;n[5124]=4;n[5121]=1;n[5123]=2;n[5125]=4;n[5126]=
4;t.exports=function(k,z,t){function y(b){this.id=f++;this.buffer=k.createBuffer();this.type=b;this.usage=35044;this.byteLength=0;this.dimension=1;this.dtype=5121;this.persistentData=null;t.profile&&(this.stats={size:0})}function u(b,a,c){b.byteLength=a.byteLength;k.bufferData(b.type,a,c)}function D(a,e,l,f,g,n){a.usage=l;if(Array.isArray(e))a.dtype=f||5126,0<e.length&&(Array.isArray(e[0])?(a.dimension=e[0].length,f=p.allocType(a.dtype,e.length*a.dimension),w(f,e,a.dimension),u(a,f,l),n?a.persistentData=
f:p.freeType(f)):"number"===typeof e[0]?(a.dimension=g,f=p.allocType(a.dtype,e.length),r(f,e),u(a,f,l),n?a.persistentData=f:p.freeType(f)):m(e[0])?(a.dimension=e[0].length,a.dtype=f||c(e[0])||5126,f=p.allocType(a.dtype,e.length*a.dimension),w(f,e,a.dimension),u(a,f,l),n?a.persistentData=f:p.freeType(f)):h.raise("invalid buffer data"));else if(m(e))a.dtype=f||c(e),a.dimension=g,u(a,e,l),n&&(a.persistentData=new Uint8Array(new Uint8Array(e.buffer)));else if(b(e)){var k=e.shape,z=e.stride;g=e.offset;
var y=0,D=0,v=0,A=0;1===k.length?(y=k[0],D=1,v=z[0],A=0):2===k.length?(y=k[0],D=k[1],v=z[0],A=z[1]):h.raise("invalid shape");a.dtype=f||c(e.data)||5126;a.dimension=D;f=p.allocType(a.dtype,y*D);d(f,e.data,y,D,v,A,g);u(a,f,l);n?a.persistentData=f:p.freeType(f)}else h.raise("invalid buffer data")}function G(b){z.bufferCount--;var c=b.buffer;h(c,"buffer must not be deleted already");k.deleteBuffer(c);b.buffer=null;delete a[b.id]}var f=0,a={};y.prototype.bind=function(){k.bindBuffer(this.type,this.buffer)};
y.prototype.destroy=function(){G(this)};var e=[];t.profile&&(z.getTotalBufferSize=function(){var b=0;Object.keys(a).forEach(function(c){b+=a[c].stats.size});return b});return{create:function(e,f,u,A){function V(a){var c=35044,e=null,d=0,f=0,p=1;Array.isArray(a)||m(a)||b(a)?e=a:"number"===typeof a?d=a|0:a&&(h.type(a,"object","buffer arguments must be an object, a number or an array"),"data"in a&&(h(null===e||Array.isArray(e)||m(e)||b(e),"invalid data for buffer"),e=a.data),"usage"in a&&(h.parameter(a.usage,
l,"invalid buffer usage"),c=l[a.usage]),"type"in a&&(h.parameter(a.type,g,"invalid buffer type"),f=g[a.type]),"dimension"in a&&(h.type(a.dimension,"number","invalid dimension"),p=a.dimension|0),"length"in a&&(h.nni(d,"buffer length must be a nonnegative integer"),d=a.length|0));C.bind();e?D(C,e,c,f,p,A):(k.bufferData(C.type,d,c),C.dtype=f||5121,C.usage=c,C.dimension=p,C.byteLength=d);t.profile&&(C.stats.size=C.byteLength*n[C.dtype]);return V}function O(b,a){h(a+b.byteLength<=C.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+
b.byteLength+" starting from offset "+a+" to a buffer of size "+C.byteLength);k.bufferSubData(C.type,a,b)}z.bufferCount++;var C=new y(f);a[C.id]=C;u||V(e);V._reglType="buffer";V._buffer=C;V.subdata=function(a,e){var l=(e||0)|0;C.bind();if(Array.isArray(a)){if(0<a.length)if("number"===typeof a[0]){var f=p.allocType(C.dtype,a.length);r(f,a);O(f,l);p.freeType(f)}else if(Array.isArray(a[0])||m(a[0])){var f=a[0].length,g=p.allocType(C.dtype,a.length*f);w(g,a,f);O(g,l);p.freeType(g)}else h.raise("invalid buffer data")}else if(m(a))O(a,
l);else if(b(a)){var n=a.shape,S=a.stride,k=g=f=0,u=0;1===n.length?(f=n[0],g=1,k=S[0],u=0):2===n.length?(f=n[0],g=n[1],k=S[0],u=S[1]):h.raise("invalid shape");n=Array.isArray(a.data)?C.dtype:c(a.data);n=p.allocType(n,f*g);d(n,a.data,f,g,k,u,a.offset);O(n,l);p.freeType(n)}else h.raise("invalid data for buffer subdata");return V};t.profile&&(V.stats=C.stats);V.destroy=function(){G(C)};return V},createStream:function(b,a){var c=e.pop();c||(c=new y(b));c.bind();D(c,a,35040,0,1,!1);return c},destroyStream:function(b){e.push(b)},
clear:function(){A(a).forEach(G);e.forEach(G)},getBuffer:function(b){return b&&b._buffer instanceof y?b._buffer:null},restore:function(){A(a).forEach(function(b){b.buffer=k.createBuffer();k.bindBuffer(b.type,b.buffer);k.bufferData(b.type,b.persistentData||b.byteLength,b.usage)})},_initBuffer:D}}},{"./constants/arraytypes.json":6,"./constants/dtypes.json":7,"./constants/usage.json":9,"./util/check":23,"./util/is-ndarray":28,"./util/is-typed-array":29,"./util/pool":31,"./util/values":34}],6:[function(k,
t,B){t.exports={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121}},{}],7:[function(k,t,B){t.exports={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,"float":5126,float32:5126}},{}],8:[function(k,t,B){t.exports={points:0,point:0,lines:1,line:1,"line loop":2,
"line strip":3,triangles:4,triangle:4,"triangle strip":5,"triangle fan":6}},{}],9:[function(k,t,B){t.exports={"static":35044,dynamic:35048,stream:35040}},{}],10:[function(k,t,B){function c(b){return Array.isArray(b)||z(b)||g(b)}function r(b){return b.sort(function(b,a){return"viewport"===b?-1:"viewport"===a?1:b<a?-1:1})}function d(b,a,c,e){this.thisDep=b;this.contextDep=a;this.propDep=c;this.append=e}function w(b){return b&&!(b.thisDep||b.contextDep||b.propDep)}function h(b){return new d(!1,!1,!1,
b)}function m(b,a){var c=b.type;return 0===c?(c=b.data.length,new d(!0,1<=c,2<=c,a)):4===c?(c=b.data,new d(c.thisDep,c.contextDep,c.propDep,a)):new d(3===c,2===c,1===c,a)}var b=k("./util/check"),A=k("./util/codegen"),p=k("./util/loop"),z=k("./util/is-typed-array"),g=k("./util/is-ndarray"),l=k("./util/is-array-like"),n=k("./dynamic"),I=k("./constants/primitives.json"),K=k("./constants/dtypes.json"),F=["x","y","z","w"],y="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),
u={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},D="constant color, constant alpha;one minus constant color, constant alpha;constant color, one minus constant alpha;one minus constant color, one minus constant alpha;constant alpha, constant color;constant alpha, one minus constant color;one minus constant alpha, constant color;one minus constant alpha, one minus constant color".split(";"),
G={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},f={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},a={frag:35632,vert:35633},e={cw:2304,ccw:2305},S=new d(!1,!1,!1,function(){});t.exports=function(g,k,z,t,O,C,La,B,ca,v,U,ia,ra,na,da){function Q(b){return b.replace(".","_")}function P(b,a,c){var e=Q(b);Fa.push(b);
Ga[e]=ya[e]=!!c;za[e]=a}function T(b,a,c){var e=Q(b);Fa.push(b);Array.isArray(c)?(ya[e]=c.slice(),Ga[e]=c.slice()):ya[e]=Ga[e]=c;Aa[e]=a}function ja(){var a=A(),c=a.link,e=a.global;a.id=Oa++;a.batchId="0";var q=c(Ma),d=a.shared={props:"a0"};Object.keys(Ma).forEach(function(b){d[b]=e.def(q,".",b)});b.optional(function(){a.CHECK=c(b);a.commandStr=b.guessCommand();a.command=c(a.commandStr);a.assert=function(b,a,e){b("if(!(",a,"))",this.CHECK,".commandRaise(",c(e),",",this.command,");")};Ha.invalidBlendCombinations=
D});var h=a.next={},l=a.current={};Object.keys(Aa).forEach(function(b){Array.isArray(ya[b])&&(h[b]=e.def(d.next,".",b),l[b]=e.def(d.current,".",b))});var f=a.constants={};Object.keys(Ha).forEach(function(b){f[b]=e.def(JSON.stringify(Ha[b]))});a.invoke=function(b,e){switch(e.type){case 0:var J=["this",d.context,d.props,a.batchId];return b.def(c(e.data),".call(",J.slice(0,Math.max(e.data.length+1,4)),")");case 1:return b.def(d.props,e.data);case 2:return b.def(d.context,e.data);case 3:return b.def("this",
e.data);case 4:return e.data.append(a,b),e.data.ref}};a.attribCache={};var J={};a.scopeAttrib=function(b){b=k.id(b);if(b in J)return J[b];var a=v.scope[b];a||(a=v.scope[b]=new Ia);return J[b]=c(a)};return a}function sa(b){var a=b["static"];b=b.dynamic;var c;if("profile"in a){var e=!!a.profile;c=h(function(b,a){return e});c.enable=e}else if("profile"in b){var d=b.profile;c=m(d,function(b,a){return b.invoke(a,d)})}return c}function Y(a,c){var e=a["static"],d=a.dynamic;if("framebuffer"in e){var q=e.framebuffer;
return q?(q=B.getFramebuffer(q),b.command(q,"invalid framebuffer object"),h(function(b,a){var c=b.link(q),e=b.shared;a.set(e.framebuffer,".next",c);e=e.context;a.set(e,".framebufferWidth",c+".width");a.set(e,".framebufferHeight",c+".height");return c})):h(function(b,a){var c=b.shared;a.set(c.framebuffer,".next","null");c=c.context;a.set(c,".framebufferWidth",c+".drawingBufferWidth");a.set(c,".framebufferHeight",c+".drawingBufferHeight");return"null"})}if("framebuffer"in d){var l=d.framebuffer;return m(l,
function(a,c){var e=a.invoke(c,l),d=a.shared,W=d.framebuffer,q=c.def(W,".getFramebuffer(",e,")");b.optional(function(){a.assert(c,"!"+e+"||"+q,"invalid framebuffer object")});c.set(W,".next",q);d=d.context;c.set(d,".framebufferWidth",q+"?"+q+".width:"+d+".drawingBufferWidth");c.set(d,".framebufferHeight",q+"?"+q+".height:"+d+".drawingBufferHeight");return q})}return null}function ga(a,c,e){function q(a){if(a in l){var J=l[a];b.commandType(J,"object","invalid "+a,e.commandStr);var x=!0,W=J.x|0,f=J.y|
0;b.command(0<=W&&0<=f,"invalid "+a,e.commandStr);var g,p;"width"in J?(g=J.width|0,b.command(0<g,"invalid "+a,e.commandStr)):x=!1;"height"in J?(p=J.height|0,b.command(0<p,"invalid "+a,e.commandStr)):x=!1;return new d(!x&&c&&c.thisDep,!x&&c&&c.contextDep,!x&&c&&c.propDep,function(c,e){var q=c.shared.context,d=g;"width"in J?b.command(0<g,"invalid "+a,c.commandStr):d=e.def(q,".","framebufferWidth","-",W);var x=p;"height"in J?b.command(0<p,"invalid "+a,c.commandStr):x=e.def(q,".","framebufferHeight",
"-",f);return[W,f,d,x]})}if(a in h){var n=h[a],x=m(n,function(c,e){var J=c.invoke(e,n);b.optional(function(){c.assert(e,J+"&&typeof "+J+'==="object"',"invalid "+a)});var q=c.shared.context,d=e.def(J,".x|0"),W=e.def(J,".y|0"),x=e.def('"width" in ',J,"?",J,".width|0:","(",q,".","framebufferWidth","-",d,")"),l=e.def('"height" in ',J,"?",J,".height|0:","(",q,".","framebufferHeight","-",W,")");b.optional(function(){c.assert(e,d+">=0&&"+W+">=0&&"+x+">0&&"+l+">0","invalid "+a)});return[d,W,x,l]});c&&(x.thisDep=
x.thisDep||c.thisDep,x.contextDep=x.contextDep||c.contextDep,x.propDep=x.propDep||c.propDep);return x}return c?new d(c.thisDep,c.contextDep,c.propDep,function(b,a){var c=b.shared.context;return[0,0,a.def(c,".","framebufferWidth"),a.def(c,".","framebufferHeight")]}):null}var l=a["static"],h=a.dynamic;if(a=q("viewport")){var f=a;a=new d(a.thisDep,a.contextDep,a.propDep,function(b,a){var c=f.append(b,a),e=b.shared.context;a.set(e,".viewportWidth",c[2]);a.set(e,".viewportHeight",c[3]);return c})}return{viewport:a,
scissor_box:q("scissor.box")}}function ka(c){function e(c){if(c in q){var J=k.id(q[c]);b.optional(function(){U.shader(a[c],J,b.guessCommand())});var d=h(function(){return J});d.id=J;return d}if(c in l){var W=l[c];return m(W,function(e,J){var d=e.invoke(J,W),q=J.def(e.shared.strings,".id(",d,")");b.optional(function(){J(e.shared.shader,".shader(",a[c],",",q,",",e.command,");")});return q})}return null}var q=c["static"],l=c.dynamic,f=e("frag"),g=e("vert"),p=null;w(f)&&w(g)?(p=U.program(g.id,f.id),c=
h(function(b,a){return b.link(p)})):c=new d(f&&f.thisDep||g&&g.thisDep,f&&f.contextDep||g&&g.contextDep,f&&f.propDep||g&&g.propDep,function(a,c){var e=a.shared.shader,q;q=f?f.append(a,c):c.def(e,".","frag");var d;d=g?g.append(a,c):c.def(e,".","vert");var x=e+".program("+d+","+q;b.optional(function(){x+=","+a.command});return c.def(x+")")});return{frag:f,vert:g,progVar:c,program:p}}function la(a,e){function q(a,c){if(a in l){var d=l[a]|0;b.command(!c||0<=d,"invalid "+a,e.commandStr);return h(function(a,
b){c&&(a.OFFSET=d);return d})}if(a in f){var W=f[a];return m(W,function(e,d){var q=e.invoke(d,W);c&&(e.OFFSET=q,b.optional(function(){e.assert(d,q+">=0","invalid "+a)}));return q})}return c&&g?h(function(a,b){a.OFFSET="0";return 0}):null}var l=a["static"],f=a.dynamic,g=function(){if("elements"in l){var a=l.elements;c(a)?a=C.getElements(C.create(a,!0)):a&&(a=C.getElements(a),b.command(a,"invalid elements",e.commandStr));var q=h(function(b,c){if(a){var e=b.link(a);return b.ELEMENTS=e}return b.ELEMENTS=
null});q.value=a;return q}if("elements"in f){var d=f.elements;return m(d,function(a,c){var e=a.shared,q=e.isBufferArgs,e=e.elements,J=a.invoke(c,d),l=c.def("null"),q=c.def(q,"(",J,")"),f=a.cond(q).then(l,"=",e,".createStream(",J,");")["else"](l,"=",e,".getElements(",J,");");b.optional(function(){a.assert(f["else"],"!"+J+"||"+l,"invalid elements")});c.entry(f);c.exit(a.cond(q).then(e,".destroyStream(",l,");"));return a.ELEMENTS=l})}return null}(),p=q("offset",!0);return{elements:g,primitive:function(){if("primitive"in
l){var a=l.primitive;b.commandParameter(a,I,"invalid primitve",e.commandStr);return h(function(b,c){return I[a]})}if("primitive"in f){var c=f.primitive;return m(c,function(a,e){var q=a.constants.primTypes,d=a.invoke(e,c);b.optional(function(){a.assert(e,d+" in "+q,"invalid primitive, must be one of "+Object.keys(I))});return e.def(q,"[",d,"]")})}return g?w(g)?g.value?h(function(a,b){return b.def(a.ELEMENTS,".primType")}):h(function(){return 4}):new d(g.thisDep,g.contextDep,g.propDep,function(a,b){var c=
a.ELEMENTS;return b.def(c,"?",c,".primType:",4)}):null}(),count:function(){if("count"in l){var a=l.count|0;b.command("number"===typeof a&&0<=a,"invalid vertex count",e.commandStr);return h(function(){return a})}if("count"in f){var c=f.count;return m(c,function(a,e){var q=a.invoke(e,c);b.optional(function(){a.assert(e,"typeof "+q+'==="number"&&'+q+">=0&&"+q+"===("+q+"|0)","invalid vertex count")});return q})}if(g){if(w(g)){if(g)return p?new d(p.thisDep,p.contextDep,p.propDep,function(a,c){var e=c.def(a.ELEMENTS,
".vertCount-",a.OFFSET);b.optional(function(){a.assert(c,e+">=0","invalid vertex offset/element buffer too small")});return e}):h(function(a,b){return b.def(a.ELEMENTS,".vertCount")});var q=h(function(){return-1});b.optional(function(){q.MISSING=!0});return q}var W=new d(g.thisDep||p.thisDep,g.contextDep||p.contextDep,g.propDep||p.propDep,function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")});b.optional(function(){W.DYNAMIC=!0});
return W}return null}(),instances:q("instances",!1),offset:p}}function ma(a,c){var q=a["static"],d=a.dynamic,g={};Fa.forEach(function(a){function x(b,c){if(a in q){var e=b(q[a]);g[n]=h(function(){return e})}else if(a in d){var l=d[a];g[n]=m(l,function(a,b){return c(a,b,a.invoke(b,l))})}}var n=Q(a);switch(a){case "cull.enable":case "blend.enable":case "dither":case "stencil.enable":case "depth.enable":case "scissor.enable":case "polygonOffset.enable":case "sample.alpha":case "sample.enable":case "depth.mask":return x(function(e){b.commandType(e,
"boolean",a,c.commandStr);return e},function(c,e,q){b.optional(function(){c.assert(e,"typeof "+q+'==="boolean"',"invalid flag "+a,c.commandStr)});return q});case "depth.func":return x(function(e){b.commandParameter(e,G,"invalid "+a,c.commandStr);return G[e]},function(c,e,q){var d=c.constants.compareFuncs;b.optional(function(){c.assert(e,q+" in "+d,"invalid "+a+", must be one of "+Object.keys(G))});return e.def(d,"[",q,"]")});case "depth.range":return x(function(a){b.command(l(a)&&2===a.length&&"number"===
typeof a[0]&&"number"===typeof a[1]&&a[0]<=a[1],"depth range is 2d array",c.commandStr);return a},function(a,c,e){b.optional(function(){a.assert(c,a.shared.isArrayLike+"("+e+")&&"+e+".length===2&&typeof "+e+'[0]==="number"&&typeof '+e+'[1]==="number"&&'+e+"[0]<="+e+"[1]","depth range must be a 2d array")});var q=c.def("+",e,"[0]"),d=c.def("+",e,"[1]");return[q,d]});case "blend.func":return x(function(a){b.commandType(a,"object","blend.func",c.commandStr);var e="srcRGB"in a?a.srcRGB:a.src,q="srcAlpha"in
a?a.srcAlpha:a.src,d="dstRGB"in a?a.dstRGB:a.dst;a="dstAlpha"in a?a.dstAlpha:a.dst;b.commandParameter(e,u,n+".srcRGB",c.commandStr);b.commandParameter(q,u,n+".srcAlpha",c.commandStr);b.commandParameter(d,u,n+".dstRGB",c.commandStr);b.commandParameter(a,u,n+".dstAlpha",c.commandStr);b.command(-1===D.indexOf(e+", "+d),"unallowed blending combination (srcRGB, dstRGB) = ("+e+", "+d+")",c.commandStr);return[u[e],u[d],u[q],u[a]]},function(c,e,q){function d(x,f){var h=e.def('"',x,f,'" in ',q,"?",q,".",x,
f,":",q,".",x);b.optional(function(){c.assert(e,h+" in "+l,"invalid "+a+"."+x+f+", must be one of "+Object.keys(u))});return h}var l=c.constants.blendFuncs;b.optional(function(){c.assert(e,q+"&&typeof "+q+'==="object"',"invalid blend func, must be an object")});var x=d("src","RGB"),f=d("dst","RGB");b.optional(function(){c.assert(e,c.constants.invalidBlendCombinations+".indexOf("+x+'+", "+'+f+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var h=e.def(l,"[",x,"]"),g=e.def(l,"[",
d("src","Alpha"),"]"),p=e.def(l,"[",f,"]"),m=e.def(l,"[",d("dst","Alpha"),"]");return[h,p,g,m]});case "blend.equation":return x(function(e){if("string"===typeof e)return b.commandParameter(e,oa,"invalid "+a,c.commandStr),[oa[e],oa[e]];if("object"===typeof e)return b.commandParameter(e.rgb,oa,a+".rgb",c.commandStr),b.commandParameter(e.alpha,oa,a+".alpha",c.commandStr),[oa[e.rgb],oa[e.alpha]];b.commandRaise("invalid blend.equation",c.commandStr)},function(c,e,q){var d=c.constants.blendEquations,l=
e.def(),x=e.def(),f=c.cond("typeof ",q,'==="string"');b.optional(function(){function b(a,e,q){c.assert(a,q+" in "+d,"invalid "+e+", must be one of "+Object.keys(oa))}b(f.then,a,q);c.assert(f["else"],q+"&&typeof "+q+'==="object"',"invalid "+a);b(f["else"],a+".rgb",q+".rgb");b(f["else"],a+".alpha",q+".alpha")});f.then(l,"=",x,"=",d,"[",q,"];");f["else"](l,"=",d,"[",q,".rgb];",x,"=",d,"[",q,".alpha];");e(f);return[l,x]});case "blend.color":return x(function(a){b.command(l(a)&&4===a.length,"blend.color must be a 4d array",
c.commandStr);return p(4,function(b){return+a[b]})},function(a,c,e){b.optional(function(){a.assert(c,a.shared.isArrayLike+"("+e+")&&"+e+".length===4","blend.color must be a 4d array")});return p(4,function(a){return c.def("+",e,"[",a,"]")})});case "stencil.mask":return x(function(a){b.commandType(a,"number",n,c.commandStr);return a|0},function(a,c,e){b.optional(function(){a.assert(c,"typeof "+e+'==="number"',"invalid stencil.mask")});return c.def(e,"|0")});case "stencil.func":return x(function(e){b.commandType(e,
"object",n,c.commandStr);var q=e.cmp||"keep",d=e.ref||0;e="mask"in e?e.mask:-1;b.commandParameter(q,G,a+".cmp",c.commandStr);b.commandType(d,"number",a+".ref",c.commandStr);b.commandType(e,"number",a+".mask",c.commandStr);return[G[q],d,e]},function(a,c,e){var q=a.constants.compareFuncs;b.optional(function(){function b(){a.assert(c,Array.prototype.join.call(arguments,""),"invalid stencil.func")}b(e+"&&typeof ",e,'==="object"');b('!("cmp" in ',e,")||(",e,".cmp in ",q,")")});var d=c.def('"cmp" in ',
e,"?",q,"[",e,".cmp]",":",7680),l=c.def(e,".ref|0"),x=c.def('"mask" in ',e,"?",e,".mask|0:-1");return[d,l,x]});case "stencil.opFront":case "stencil.opBack":return x(function(e){b.commandType(e,"object",n,c.commandStr);var q=e.fail||"keep",d=e.zfail||"keep";e=e.zpass||"keep";b.commandParameter(q,f,a+".fail",c.commandStr);b.commandParameter(d,f,a+".zfail",c.commandStr);b.commandParameter(e,f,a+".zpass",c.commandStr);return["stencil.opBack"===a?1029:1028,f[q],f[d],f[e]]},function(c,e,q){function d(x){b.optional(function(){c.assert(e,
'!("'+x+'" in '+q+")||("+q+"."+x+" in "+l+")","invalid "+a+"."+x+", must be one of "+Object.keys(f))});return e.def('"',x,'" in ',q,"?",l,"[",q,".",x,"]:",7680)}var l=c.constants.stencilOps;b.optional(function(){c.assert(e,q+"&&typeof "+q+'==="object"',"invalid "+a)});return["stencil.opBack"===a?1029:1028,d("fail"),d("zfail"),d("zpass")]});case "polygonOffset.offset":return x(function(a){b.commandType(a,"object",n,c.commandStr);var e=a.factor|0;a=a.units|0;b.commandType(e,"number",n+".factor",c.commandStr);
b.commandType(a,"number",n+".units",c.commandStr);return[e,a]},function(c,e,q){b.optional(function(){c.assert(e,q+"&&typeof "+q+'==="object"',"invalid "+a)});var d=e.def(q,".factor|0"),x=e.def(q,".units|0");return[d,x]});case "cull.face":return x(function(a){var e=0;"front"===a?e=1028:"back"===a&&(e=1029);b.command(!!e,n,c.commandStr);return e},function(a,c,e){b.optional(function(){a.assert(c,e+'==="front"||'+e+'==="back"',"invalid cull.face")});return c.def(e,'==="front"?',1028,":",1029)});case "lineWidth":return x(function(a){b.command("number"===
typeof a&&a>=t.lineWidthDims[0]&&a<=t.lineWidthDims[1],"invalid line width, must positive number between "+t.lineWidthDims[0]+" and "+t.lineWidthDims[1],c.commandStr);return a},function(a,c,e){b.optional(function(){a.assert(c,"typeof "+e+'==="number"&&'+e+">="+t.lineWidthDims[0]+"&&"+e+"<="+t.lineWidthDims[1],"invalid line width")});return e});case "frontFace":return x(function(a){b.commandParameter(a,e,n,c.commandStr);return e[a]},function(a,c,e){b.optional(function(){a.assert(c,e+'==="cw"||'+e+
'==="ccw"',"invalid frontFace, must be one of cw,ccw")});return c.def(e+'==="cw"?2304:2305')});case "colorMask":return x(function(a){b.command(l(a)&&4===a.length,"color.mask must be length 4 array",c.commandStr);return a.map(function(a){return!!a})},function(a,c,e){b.optional(function(){a.assert(c,a.shared.isArrayLike+"("+e+")&&"+e+".length===4","invalid color.mask")});return p(4,function(a){return"!!"+e+"["+a+"]"})});case "sample.coverage":return x(function(a){b.command("object"===typeof a&&a,n,
c.commandStr);var e="value"in a?a.value:1;a=!!a.invert;b.command("number"===typeof e&&0<=e&&1>=e,"sample.coverage.value must be a number between 0 and 1",c.commandStr);return[e,a]},function(a,c,e){b.optional(function(){a.assert(c,e+"&&typeof "+e+'==="object"',"invalid sample.coverage")});var q=c.def('"value" in ',e,"?+",e,".value:1"),d=c.def("!!",e,".invert");return[q,d]})}});return g}function pa(a,c){var e=a["static"],q=a.dynamic,d={};Object.keys(e).forEach(function(a){var q=e[a],x;if("number"===
typeof q||"boolean"===typeof q)x=h(function(){return q});else if("function"===typeof q){var f=q._reglType;"texture2d"===f||"textureCube"===f?x=h(function(a){return a.link(q)}):"framebuffer"===f||"framebufferCube"===f?(b.command(0<q.color.length,'missing color attachment for framebuffer sent to uniform "'+a+'"',c.commandStr),x=h(function(a){return a.link(q.color[0])})):b.commandRaise('invalid data for uniform "'+a+'"',c.commandStr)}else l(q)?x=h(function(c){return c.global.def("[",p(q.length,function(e){b.command("number"===
typeof q[e]||"boolean"===typeof q[e],"invalid uniform "+a,c.commandStr);return q[e]}),"]")}):b.commandRaise('invalid or missing data for uniform "'+a+'"',c.commandStr);x.value=q;d[a]=x});Object.keys(q).forEach(function(a){var b=q[a];d[a]=m(b,function(a,c){return a.invoke(c,b)})});return d}function ta(a,e){var q=a["static"],d=a.dynamic,f={};Object.keys(q).forEach(function(a){var d=q[a],x=k.id(a),g=new Ia;if(c(d))g.state=1,g.buffer=O.getBuffer(O.create(d,34962,!1,!0)),g.type=g.buffer.dtype;else{var p=
O.getBuffer(d);if(p)g.state=1,g.buffer=p,g.type=p.dtype;else if(b.command("object"===typeof d&&d,"invalid data for attribute "+a,e.commandStr),d.constant){var m=d.constant;g.buffer="null";g.state=2;"number"===typeof m?g.x=m:(b.command(l(m)&&0<m.length&&4>=m.length,"invalid constant for attribute "+a,e.commandStr),F.forEach(function(a,b){b<m.length&&(g[a]=m[b])}))}else{p=c(d.buffer)?O.getBuffer(O.create(d.buffer,34962,!1,!0)):O.getBuffer(d.buffer);b.command(!!p,'missing buffer for attribute "'+a+'"',
e.commandStr);var n=d.offset|0;b.command(0<=n,'invalid offset for attribute "'+a+'"',e.commandStr);var E=d.stride|0;b.command(0<=E&&256>E,'invalid stride for attribute "'+a+'", must be integer betweeen [0, 255]',e.commandStr);var r=d.size|0;b.command(!("size"in d)||0<r&&4>=r,'invalid size for attribute "'+a+'", must be 1,2,3,4',e.commandStr);var L=!!d.normalized,w=0;"type"in d&&(b.commandParameter(d.type,K,"invalid type for attribute "+a,e.commandStr),w=K[d.type]);var u=d.divisor|0;"divisor"in d&&
(b.command(0===u||Ba,'cannot specify divisor for attribute "'+a+'", instancing not supported',e.commandStr),b.command(0<=u,'invalid divisor for attribute "'+a+'"',e.commandStr));b.optional(function(){var c=e.commandStr,q="buffer offset divisor normalized type size stride".split(" ");Object.keys(d).forEach(function(e){b.command(0<=q.indexOf(e),'unknown parameter "'+e+'" for attribute pointer "'+a+'" (valid parameters are '+q+")",c)})});g.buffer=p;g.state=1;g.size=r;g.normalized=L;g.type=w||p.dtype;
g.offset=n;g.stride=E;g.divisor=u}}f[a]=h(function(a,b){var c=a.attribCache;if(x in c)return c[x];var e={isStream:!1};Object.keys(g).forEach(function(a){e[a]=g[a]});g.buffer&&(e.buffer=a.link(g.buffer));return c[x]=e})});Object.keys(d).forEach(function(a){var c=d[a];f[a]=m(c,function(e,q){function d(a){q(h[a],"=",x,".",a,"|0;")}var x=e.invoke(q,c),f=e.shared,l=f.isBufferArgs,g=f.buffer;b.optional(function(){e.assert(q,x+"&&(typeof "+x+'==="object"||typeof '+x+'==="function")&&('+l+"("+x+")||"+g+".getBuffer("+
x+")||"+g+".getBuffer("+x+".buffer)||"+l+"("+x+'.buffer)||("constant" in '+x+"&&(typeof "+x+'.constant==="number"||'+f.isArrayLike+"("+x+".constant))))",'invalid dynamic attribute "'+a+'"')});var h={isStream:q.def(!1)},p=new Ia;p.state=1;Object.keys(p).forEach(function(a){h[a]=q.def(""+p[a])});var m=h.buffer,n=h.type;q("if(",l,"(",x,")){",h.isStream,"=true;",m,"=",g,".createStream(",34962,",",x,");",n,"=",m,".dtype;","}else{",m,"=",g,".getBuffer(",x,");","if(",m,"){",n,"=",m,".dtype;",'}else if("constant" in ',
x,"){",h.state,"=",2,";","if(typeof "+x+'.constant === "number"){',h[F[0]],"=",x,".constant;",F.slice(1).map(function(a){return h[a]}).join("="),"=0;","}else{",F.map(function(a,b){return h[a]+"="+x+".constant.length>="+b+"?"+x+".constant["+b+"]:0;"}).join(""),"}}else{","if(",l,"(",x,".buffer)){",m,"=",g,".createStream(",34962,",",x,".buffer);","}else{",m,"=",g,".getBuffer(",x,".buffer);","}",n,'="type" in ',x,"?",f.glTypes,"[",x,".type]:",m,".dtype;",h.normalized,"=!!",x,".normalized;");d("size");
d("offset");d("stride");d("divisor");q("}}");q.exit("if(",h.isStream,"){",g,".destroyStream(",m,");","}");return h})});return f}function X(a){var b=a["static"],c=a.dynamic,e={};Object.keys(b).forEach(function(a){var c=b[a];e[a]=h(function(a,b){return"number"===typeof c||"boolean"===typeof c?""+c:a.link(c)})});Object.keys(c).forEach(function(a){var b=c[a];e[a]=m(b,function(a,c){return a.invoke(c,b)})});return e}function ea(a,c,e,q,d){function f(a){var b=m[a];b&&(n[a]=b)}var l=a["static"],h=a.dynamic;
b.optional(function(){function a(e){Object.keys(e).forEach(function(a){b.command(0<=c.indexOf(a),'unknown parameter "'+a+'"',d.commandStr)})}var c="framebuffer vert frag elements primitive offset count instances profile".split(" ").concat(Fa);a(l);a(h)});var g=Y(a,d),m=ga(a,g,d),p=la(a,d),n=ma(a,d),E=ka(a,d);f("viewport");f(Q("scissor.box"));var k=0<Object.keys(n).length,g={framebuffer:g,draw:p,shader:E,state:n,dirty:k};g.profile=sa(a,d);g.uniforms=pa(e,d);g.attributes=ta(c,d);g.context=X(q,d);return g}
function M(a,b,c){var e=a.shared.context,q=a.scope();Object.keys(c).forEach(function(d){b.save(e,"."+d);q(e,".",d,"=",c[d].append(a,b),";")});b(q)}function Z(a,b,c,e){var q=a.shared,d=q.gl,f=q.framebuffer,l;Ja&&(l=b.def(q.extensions,".webgl_draw_buffers"));var g=a.constants,q=g.drawBuffer,g=g.backBuffer;a=c?c.append(a,b):b.def(f,".next");e||b("if(",a,"!==",f,".cur){");b("if(",a,"){",d,".bindFramebuffer(",36160,",",a,".framebuffer);");Ja&&b(l,".drawBuffersWEBGL(",q,"[",a,".colorAttachments.length]);");
b("}else{",d,".bindFramebuffer(",36160,",null);");Ja&&b(l,".drawBuffersWEBGL(",g,");");b("}",f,".cur=",a,";");e||b("}")}function H(a,b,c){var e=a.shared,q=e.gl,d=a.current,f=a.next,l=e.current,g=e.next,h=a.cond(l,".dirty");Fa.forEach(function(b){b=Q(b);if(!(b in c.state)){var e,m;if(b in f){e=f[b];m=d[b];var n=p(ya[b].length,function(a){return h.def(e,"[",a,"]")});h(a.cond(n.map(function(a,b){return a+"!=="+m+"["+b+"]"}).join("||")).then(q,".",Aa[b],"(",n,");",n.map(function(a,b){return m+"["+b+"]="+
a}).join(";"),";"))}else e=h.def(g,".",b),n=a.cond(e,"!==",l,".",b),h(n),b in za?n(a.cond(e).then(q,".enable(",za[b],");")["else"](q,".disable(",za[b],");"),l,".",b,"=",e,";"):n(q,".",Aa[b],"(",e,");",l,".",b,"=",e,";")}});0===Object.keys(c.state).length&&h(l,".dirty=false;");b(h)}function ba(a,b,c,e){var q=a.shared,d=a.current,f=q.current,g=q.gl;r(Object.keys(c)).forEach(function(q){var h=c[q];if(!e||e(h)){var m=h.append(a,b);if(za[q]){var n=za[q];w(h)?m?b(g,".enable(",n,");"):b(g,".disable(",n,
");"):b(a.cond(m).then(g,".enable(",n,");")["else"](g,".disable(",n,");"));b(f,".",q,"=",m,";")}else if(l(m)){var p=d[q];b(g,".",Aa[q],"(",m,");",m.map(function(a,b){return p+"["+b+"]="+a}).join(";"),";")}else b(g,".",Aa[q],"(",m,");",f,".",q,"=",m,";")}})}function aa(a,b){Ba&&!a.instancing&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function ua(a,b,c,e,q){function d(){return"undefined"===typeof performance?"Date.now()":"performance.now()"}function f(a){E=b.def();a(E,"=",
d(),";");"string"===typeof q?a(m,".count+=",q,";"):a(m,".count++;");na&&(e?(k=b.def(),a(k,"=",p,".getNumPendingQueries();")):a(p,".beginQuery(",m,");"))}function l(a){a(m,".cpuTime+=",d(),"-",E,";");na&&(e?a(p,".pushScopeStats(",k,",",p,".getNumPendingQueries(),",m,");"):a(p,".endQuery();"))}function g(a){var c=b.def(n,".profile");b(n,".profile=",a,";");b.exit(n,".profile=",c,";")}var h=a.shared,m=a.stats,n=h.current,p=h.timer;c=c.profile;var E,k;if(c){if(w(c)){c.enable?(f(b),l(b.exit),g("true")):
g("false");return}c=c.append(a,b);g(c)}else c=b.def(n,".profile");h=a.block();f(h);b("if(",c,"){",h,"}");a=a.block();l(a);b.exit("if(",c,"){",a,"}")}function fa(a,c,e,q,d){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function l(b,e,q){function d(){c("if(!",n,".buffer){",h,".enableVertexAttribArray(",m,");}");var b=q.type,f;f=q.size?c.def(q.size,"||",e):e;c("if(",n,".type!==",
b,"||",n,".size!==",f,"||",k.map(function(a){return n+"."+a+"!=="+q[a]}).join("||"),"){",h,".bindBuffer(",34962,",",p,".buffer);",h,".vertexAttribPointer(",[m,f,b,q.normalized,q.stride,q.offset],");",n,".type=",b,";",n,".size=",f,";",k.map(function(a){return n+"."+a+"="+q[a]+";"}).join(""),"}");Ba&&(b=q.divisor,c("if(",n,".divisor!==",b,"){",a.instancing,".vertexAttribDivisorANGLE(",[m,b],");",n,".divisor=",b,";}"))}function f(){c("if(",n,".buffer){",h,".disableVertexAttribArray(",m,");","}if(",F.map(function(a,
b){return n+"."+a+"!=="+E[b]}).join("||"),"){",h,".vertexAttrib4f(",m,",",E,");",F.map(function(a,b){return n+"."+a+"="+E[b]+";"}).join(""),"}")}var h=g.gl,m=c.def(b,".location"),n=c.def(g.attributes,"[",m,"]");b=q.state;var p=q.buffer,E=[q.x,q.y,q.z,q.w],k=["buffer","normalized","offset","stride"];1===b?d():2===b?f():(c("if(",b,"===",1,"){"),d(),c("}else{"),f(),c("}"))}var g=a.shared;q.forEach(function(q){var g=q.name,h=e.attributes[g],m;if(h){if(!d(h))return;m=h.append(a,c)}else{if(!d(S))return;
var n=a.scopeAttrib(g);b.optional(function(){a.assert(c,n+".state","missing attribute "+g)});m={};Object.keys(new Ia).forEach(function(a){m[a]=c.def(n,".",a)})}l(a.link(q),f(q.info.type),m)})}function qa(a,c,e,q,d){for(var f=a.shared,g=f.gl,h,m=0;m<q.length;++m){var n=q[m],E=n.name,r=n.info.type,u=e.uniforms[E],n=a.link(n)+".location",L;if(u){if(!d(u))continue;if(w(u)){var v=u.value;b.command(null!==v&&"undefined"!==typeof v,'missing uniform "'+E+'"',a.commandStr);if(35678===r||35680===r)b.command("function"===
typeof v&&(35678===r&&("texture2d"===v._reglType||"framebuffer"===v._reglType)||35680===r&&("textureCube"===v._reglType||"framebufferCube"===v._reglType)),"invalid texture for uniform "+E,a.commandStr),u=a.link(v._texture||v.color[0]._texture),c(g,".uniform1i(",n,",",u+".bind());"),c.exit(u,".unbind();");else if(35674===r||35675===r||35676===r){b.optional(function(){b.command(l(v),"invalid matrix for uniform "+E,a.commandStr);b.command(35674===r&&4===v.length||35675===r&&9===v.length||35676===r&&
16===v.length,"invalid length for matrix uniform "+E,a.commandStr)});var u=a.global.def("new Float32Array(["+Array.prototype.slice.call(v)+"])"),z=2;35675===r?z=3:35676===r&&(z=4);c(g,".uniformMatrix",z,"fv(",n,",false,",u,");")}else{switch(r){case 5126:b.commandType(v,"number","uniform "+E,a.commandStr);h="1f";break;case 35664:b.command(l(v)&&2===v.length,"uniform "+E,a.commandStr);h="2f";break;case 35665:b.command(l(v)&&3===v.length,"uniform "+E,a.commandStr);h="3f";break;case 35666:b.command(l(v)&&
4===v.length,"uniform "+E,a.commandStr);h="4f";break;case 35670:b.commandType(v,"boolean","uniform "+E,a.commandStr);h="1i";break;case 5124:b.commandType(v,"number","uniform "+E,a.commandStr);h="1i";break;case 35671:b.command(l(v)&&2===v.length,"uniform "+E,a.commandStr);h="2i";break;case 35667:b.command(l(v)&&2===v.length,"uniform "+E,a.commandStr);h="2i";break;case 35672:b.command(l(v)&&3===v.length,"uniform "+E,a.commandStr);h="3i";break;case 35668:b.command(l(v)&&3===v.length,"uniform "+E,a.commandStr);
h="3i";break;case 35673:b.command(l(v)&&4===v.length,"uniform "+E,a.commandStr);h="4i";break;case 35669:b.command(l(v)&&4===v.length,"uniform "+E,a.commandStr),h="4i"}c(g,".uniform",h,"(",n,",",l(v)?Array.prototype.slice.call(v):v,");")}continue}else L=u.append(a,c)}else{if(!d(S))continue;L=c.def(f.uniforms,"[",k.id(E),"]")}35678===r?c("if(",L,"&&",L,'._reglType==="framebuffer"){',L,"=",L,".color[0];","}"):35680===r&&c("if(",L,"&&",L,'._reglType==="framebufferCube"){',L,"=",L,".color[0];","}");b.optional(function(){function b(e,
q){a.assert(c,e,'bad data or missing for uniform "'+E+'".  '+q)}function e(a){b("typeof "+L+'==="'+a+'"',"invalid type, expected "+a)}function q(c,e){b(f.isArrayLike+"("+L+")&&"+L+".length==="+c,"invalid vector, should have length "+c,a.commandStr)}function d(c){b("typeof "+L+'==="function"&&'+L+'._reglType==="texture'+(3553===c?"2d":"Cube")+'"',"invalid texture type",a.commandStr)}switch(r){case 5124:e("number");break;case 35667:q(2,"number");break;case 35668:q(3,"number");break;case 35669:q(4,"number");
break;case 5126:e("number");break;case 35664:q(2,"number");break;case 35665:q(3,"number");break;case 35666:q(4,"number");break;case 35670:e("boolean");break;case 35671:q(2,"boolean");break;case 35672:q(3,"boolean");break;case 35673:q(4,"boolean");break;case 35674:q(4,"number");break;case 35675:q(9,"number");break;case 35676:q(16,"number");break;case 35678:d(3553);break;case 35680:d(34067)}});u=1;switch(r){case 35678:case 35680:u=c.def(L,"._texture");c(g,".uniform1i(",n,",",u,".bind());");c.exit(u,
".unbind();");continue;case 5124:case 35670:h="1i";break;case 35667:case 35671:h="2i";u=2;break;case 35668:case 35672:h="3i";u=3;break;case 35669:case 35673:h="4i";u=4;break;case 5126:h="1f";break;case 35664:h="2f";u=2;break;case 35665:h="3f";u=3;break;case 35666:h="4f";u=4;break;case 35674:h="Matrix2fv";break;case 35675:h="Matrix3fv";break;case 35676:h="Matrix4fv"}c(g,".uniform",h,"(",n,",");if("M"===h.charAt(0)){var n=Math.pow(r-35674+2,2),D=a.global.def("new Float32Array(",n,")");c("false,(Array.isArray(",
L,")||",L," instanceof Float32Array)?",L,":(",p(n,function(a){return D+"["+a+"]="+L+"["+a+"]"}),",",D,")")}else 1<u?c(p(u,function(a){return L+"["+a+"]"})):c(L);c(");")}}function Ca(a,c,e,q){function d(b){var f=m[b];return f?f.contextDep&&q.contextDynamic||f.propDep?f.append(a,e):f.append(a,c):c.def(n,".",b)}function f(){function a(){e(r,".drawElementsInstancedANGLE(",[E,u,k,v+"<<(("+k+"-5121)>>1)",L],");")}function b(){e(r,".drawArraysInstancedANGLE(",[E,v,u,L],");")}p?S?a():(e("if(",p,"){"),a(),
e("}else{"),b(),e("}")):b()}function h(){function a(){e(g+".drawElements("+[E,u,k,v+"<<(("+k+"-5121)>>1)"]+");")}function b(){e(g+".drawArrays("+[E,v,u]+");")}p?S?a():(e("if(",p,"){"),a(),e("}else{"),b(),e("}")):b()}var l=a.shared,g=l.gl,n=l.draw,m=q.draw,p=function(){var b=m.elements,d=c;if(b){if(b.contextDep&&q.contextDynamic||b.propDep)d=e;b=b.append(a,d)}else b=d.def(n,".","elements");b&&d("if("+b+")"+g+".bindBuffer(34963,"+b+".buffer.buffer);");return b}(),E=d("primitive"),v=d("offset"),u=function(){var d=
m.count,f,h=c;if(d){if(d.contextDep&&q.contextDynamic||d.propDep)h=e;f=d.append(a,h);b.optional(function(){d.MISSING&&a.assert(c,"false","missing vertex count");d.DYNAMIC&&a.assert(h,f+">=0","missing vertex count")})}else f=h.def(n,".","count"),b.optional(function(){a.assert(h,f+">=0","missing vertex count")});return f}();if("number"===typeof u){if(0===u)return}else e("if(",u,"){"),e.exit("}");var L,r;Ba&&(L=d("instances"),r=a.instancing);var k=p+".type",S=m.elements&&w(m.elements);Ba&&("number"!==
typeof L||0<=L)?"string"===typeof L?(e("if(",L,">0){"),f(),e("}else if(",L,"<0){"),h(),e("}")):f():h()}function Da(a,c,e,q,d){var f=ja();d=f.proc("body",d);b.optional(function(){f.commandStr=c.commandStr;f.command=f.link(c.commandStr)});Ba&&(f.instancing=d.def(f.shared.extensions,".angle_instanced_arrays"));a(f,d,e,q);return f.compile().body}function Ka(a,b,c,e){aa(a,b);fa(a,b,c,e.attributes,function(){return!0});qa(a,b,c,e.uniforms,function(){return!0});Ca(a,b,b,c)}function va(a,b){var c=a.proc("draw",
1);aa(a,c);M(a,c,b.context);Z(a,c,b.framebuffer);H(a,c,b);ba(a,c,b.state);ua(a,c,b,!1,!0);var e=b.shader.progVar.append(a,c);c(a.shared.gl,".useProgram(",e,".program);");if(b.shader.program)Ka(a,c,b,b.shader.program);else{var q=a.global.def("{}"),d=c.def(e,".id"),f=c.def(q,"[",d,"]");c(a.cond(f).then(f,".call(this,a0);")["else"](f,"=",q,"[",d,"]=",a.link(function(c){return Da(Ka,a,b,c,1)}),"(",e,");",f,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;")}function Ea(a,
b,c,e){function q(){return!0}a.batchId="a1";aa(a,b);fa(a,b,c,e.attributes,q);qa(a,b,c,e.uniforms,q);Ca(a,b,b,c)}function wa(a,b,c,e){function q(a){return a.contextDep&&f||a.propDep}function d(a){return!q(a)}aa(a,b);var f=c.contextDep,h=b.def(),l=b.def();a.shared.props=l;a.batchId=h;var g=a.scope(),m=a.scope();b(g.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",l,"=","a0","[",h,"];",m,"}",g.exit);c.needsContext&&M(a,m,c.context);c.needsFramebuffer&&Z(a,m,c.framebuffer);ba(a,m,c.state,q);c.profile&&q(c.profile)&&
ua(a,m,c,!1,!0);e?(fa(a,g,c,e.attributes,d),fa(a,m,c,e.attributes,q),qa(a,g,c,e.uniforms,d),qa(a,m,c,e.uniforms,q),Ca(a,g,m,c)):(b=a.global.def("{}"),e=c.shader.progVar.append(a,m),l=m.def(e,".id"),g=m.def(b,"[",l,"]"),m(a.shared.gl,".useProgram(",e,".program);","if(!",g,"){",g,"=",b,"[",l,"]=",a.link(function(b){return Da(Ea,a,c,b,2)}),"(",e,");}",g,".call(this,a0[",h,"],",h,");"))}function q(a,b){function c(a){return a.contextDep&&q||a.propDep}var e=a.proc("batch",2);a.batchId="0";aa(a,e);var q=
!1,d=!0;Object.keys(b.context).forEach(function(a){q=q||b.context[a].propDep});q||(M(a,e,b.context),d=!1);var f=b.framebuffer,h=!1;f?(f.propDep?q=h=!0:f.contextDep&&q&&(h=!0),h||Z(a,e,f)):Z(a,e,null);b.state.viewport&&b.state.viewport.propDep&&(q=!0);H(a,e,b);ba(a,e,b.state,function(a){return!c(a)});b.profile&&c(b.profile)||ua(a,e,b,!1,"a1");b.contextDep=q;b.needsContext=d;b.needsFramebuffer=h;d=b.shader.progVar;if(d.contextDep&&q||d.propDep)wa(a,e,b,null);else if(d=d.append(a,e),e(a.shared.gl,".useProgram(",
d,".program);"),b.shader.program)wa(a,e,b,b.shader.program);else{var f=a.global.def("{}"),h=e.def(d,".id"),g=e.def(f,"[",h,"]");e(a.cond(g).then(g,".call(this,a0,a1);")["else"](g,"=",f,"[",h,"]=",a.link(function(c){return Da(wa,a,b,c,2)}),"(",d,");",g,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&e(a.shared.current,".dirty=true;")}function L(a,b){function c(d){var f=b.shader[d];f&&e.set(q.shader,"."+d,f.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var q=a.shared,d=q.current;M(a,e,b.context);
b.framebuffer&&b.framebuffer.append(a,e);r(Object.keys(b.state)).forEach(function(c){var d=b.state[c].append(a,e);l(d)?d.forEach(function(b,q){e.set(a.next[c],"["+q+"]",b)}):e.set(q.next,"."+c,d)});ua(a,e,b,!0,!0);["elements","offset","count","instances","primitive"].forEach(function(c){var d=b.draw[c];d&&e.set(q.draw,"."+c,""+d.append(a,e))});Object.keys(b.uniforms).forEach(function(c){e.set(q.uniforms,"["+k.id(c)+"]",b.uniforms[c].append(a,e))});Object.keys(b.attributes).forEach(function(c){var q=
b.attributes[c].append(a,e),d=a.scopeAttrib(c);Object.keys(new Ia).forEach(function(a){e.set(d,"."+a,q[a])})});c("vert");c("frag");0<Object.keys(b.state).length&&(e(d,".dirty=true;"),e.exit(d,".dirty=true;"));e("a1(",a.shared.context,",a0,",a.batchId,");")}function E(a){if("object"===typeof a&&!l(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(n.isDynamic(a[b[c]]))return!0;return!1}}function Na(a,b,c){function e(a,b){f.forEach(function(c){var e=q[c];n.isDynamic(e)&&(e=a.invoke(b,e),b(p,".",c,"=",
e,";"))})}var q=b["static"][c];if(q&&E(q)){var d=a.global,f=Object.keys(q),h=!1,g=!1,l=!1,p=a.global.def("{}");f.forEach(function(b){var c=q[b];if(n.isDynamic(c))"function"===typeof c&&(c=q[b]=n.unbox(c)),b=m(c,null),h=h||b.thisDep,l=l||b.propDep,g=g||b.contextDep;else{d(p,".",b,"=");switch(typeof c){case "number":d(c);break;case "string":d('"',c,'"');break;case "object":Array.isArray(c)&&d("[",c.join(),"]");break;default:d(a.link(c))}d(";")}});b.dynamic[c]=new n.DynamicVariable(4,{thisDep:h,contextDep:g,
propDep:l,ref:p,append:e});delete b["static"][c]}}var Ia=v.Record,oa={add:32774,subtract:32778,"reverse subtract":32779};z.ext_blend_minmax&&(oa.min=32775,oa.max=32776);var Ba=z.angle_instanced_arrays,Ja=z.webgl_draw_buffers,ya={dirty:!0,profile:da.profile},Ga={},Fa=[],za={},Aa={};P("dither",3024);P("blend.enable",3042);T("blend.color","blendColor",[0,0,0,0]);T("blend.equation","blendEquationSeparate",[32774,32774]);T("blend.func","blendFuncSeparate",[1,0,1,0]);P("depth.enable",2929,!0);T("depth.func",
"depthFunc",513);T("depth.range","depthRange",[0,1]);T("depth.mask","depthMask",!0);T("colorMask","colorMask",[!0,!0,!0,!0]);P("cull.enable",2884);T("cull.face","cullFace",1029);T("frontFace","frontFace",2305);T("lineWidth","lineWidth",1);P("polygonOffset.enable",32823);T("polygonOffset.offset","polygonOffset",[0,0]);P("sample.alpha",32926);P("sample.enable",32928);T("sample.coverage","sampleCoverage",[1,!1]);P("stencil.enable",2960);T("stencil.mask","stencilMask",-1);T("stencil.func","stencilFunc",
[519,0,-1]);T("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]);T("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]);P("scissor.enable",3089);T("scissor.box","scissor",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);T("viewport","viewport",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);var Ma={gl:g,context:ra,strings:k,next:Ga,current:ya,draw:ia,elements:C,buffer:O,shader:U,attributes:v.state,uniforms:ca,framebuffer:B,extensions:z,timer:na,isBufferArgs:c},Ha={primTypes:I,
compareFuncs:G,blendFuncs:u,blendEquations:oa,stencilOps:f,glTypes:K,orientationType:e};b.optional(function(){Ma.isArrayLike=l});Ja&&(Ha.backBuffer=[1029],Ha.drawBuffer=p(t.maxDrawbuffers,function(a){return 0===a?[0]:p(a,function(a){return 36064+a})}));var Oa=0;return{next:Ga,current:ya,procs:function(){var a=ja(),b=a.proc("poll"),c=a.proc("refresh"),e=a.block();b(e);c(e);var q=a.shared,d=q.gl,f=q.next,h=q.current;e(h,".dirty=false;");Z(a,b);Z(a,c,null,!0);var m=g.getExtension("angle_instanced_arrays"),
n;m&&(n=a.link(m));for(var E=0;E<t.maxAttributes;++E){var v=c.def(q.attributes,"[",E,"]"),u=a.cond(v,".buffer");u.then(d,".enableVertexAttribArray(",E,");",d,".bindBuffer(",34962,",",v,".buffer.buffer);",d,".vertexAttribPointer(",E,",",v,".size,",v,".type,",v,".normalized,",v,".stride,",v,".offset);")["else"](d,".disableVertexAttribArray(",E,");",d,".vertexAttrib4f(",E,",",v,".x,",v,".y,",v,".z,",v,".w);",v,".buffer=null;");c(u);m&&c(n,".vertexAttribDivisorANGLE(",E,",",v,".divisor);")}Object.keys(za).forEach(function(q){var g=
za[q],l=e.def(f,".",q),m=a.block();m("if(",l,"){",d,".enable(",g,")}else{",d,".disable(",g,")}",h,".",q,"=",l,";");c(m);b("if(",l,"!==",h,".",q,"){",m,"}")});Object.keys(Aa).forEach(function(q){var g=Aa[q],m=ya[q],n,E,v=a.block();v(d,".",g,"(");l(m)?(g=m.length,n=a.global.def(f,".",q),E=a.global.def(h,".",q),v(p(g,function(a){return n+"["+a+"]"}),");",p(g,function(a){return E+"["+a+"]="+n+"["+a+"];"}).join("")),b("if(",p(g,function(a){return n+"["+a+"]!=="+E+"["+a+"]"}).join("||"),"){",v,"}")):(n=
e.def(f,".",q),E=e.def(h,".",q),v(n,");",h,".",q,"=",n,";"),b("if(",n,"!==",E,"){",v,"}"));c(v)});return a.compile()}(),compile:function(a,b,c,e,d){var f=ja();f.stats=f.link(d);Object.keys(b["static"]).forEach(function(a){Na(f,b,a)});y.forEach(function(b){Na(f,a,b)});c=ea(a,b,c,e,f);va(f,c);L(f,c);q(f,c);return f.compile()}}}},{"./constants/dtypes.json":7,"./constants/primitives.json":8,"./dynamic":11,"./util/check":23,"./util/codegen":25,"./util/is-array-like":27,"./util/is-ndarray":28,"./util/is-typed-array":29,
"./util/loop":30}],11:[function(k,t,B){function c(c,d){this.id=w++;this.type=c;this.data=d}function r(c){if(0===c.length)return[];var d=c.charAt(0),b=c.charAt(c.length-1);if(1<c.length&&d===b&&('"'===d||"'"===d))return['"'+c.substr(1,c.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(d=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(c))return r(c.substr(0,d.index)).concat(r(d[1])).concat(r(c.substr(d.index+d[0].length)));d=c.split(".");if(1===d.length)return['"'+c.replace(/\\/g,"\\\\").replace(/"/g,
'\\"')+'"'];c=[];for(b=0;b<d.length;++b)c=c.concat(r(d[b]));return c}function d(c){return"["+r(c).join("][")+"]"}var w=0;t.exports={DynamicVariable:c,define:function(h,m){return new c(h,d(m+""))},isDynamic:function(d){return"function"===typeof d&&!d._reglType||d instanceof c},unbox:function(d,m){return"function"===typeof d?new c(0,d):d},accessor:d}},{}],12:[function(k,t,B){var c=k("./util/check"),r=k("./util/is-typed-array"),d=k("./util/is-ndarray"),w=k("./util/values"),h=k("./constants/primitives.json"),
m=k("./constants/usage.json");t.exports=function(b,k,p,z){function g(b){this.id=t++;I[this.id]=this;this.buffer=b;this.primType=4;this.type=this.vertCount=0}function l(b,g,h,f,a,e,l){(e=l)||r(g)&&(!d(g)||r(g.data))||(e=k.oes_element_index_uint?5125:5123);b.buffer.bind();p._initBuffer(b.buffer,g,h,e,3);g=l;if(!l){switch(b.buffer.dtype){case 5121:case 5120:g=5121;break;case 5123:case 5122:g=5123;break;case 5125:case 5124:g=5125;break;default:c.raise("unsupported type for element array")}b.buffer.dtype=
g}b.type=g;c(5125!==g||!!k.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");0>a&&(a=b.buffer.byteLength,5123===g?a>>=1:5125===g&&(a>>=2));b.vertCount=a;a=f;0>f&&(a=4,f=b.buffer.dimension,1===f&&(a=0),2===f&&(a=1),3===f&&(a=4));b.primType=a}function n(b){z.elementsCount--;c(null!==b.buffer,"must not double destroy elements");delete I[b.id];b.buffer.destroy();b.buffer=null}var I={},t=0,F={uint8:5121,uint16:5123};k.oes_element_index_uint&&(F.uint32=
5125);g.prototype.bind=function(){this.buffer.bind()};var y=[];return{create:function(k,w){function y(e){if(e)if("number"===typeof e)f(e),a.primType=4,a.vertCount=e|0,a.type=5121;else{var g=null,n=35044,p=-1,k=-1,u=0,w=0;Array.isArray(e)||r(e)||d(e)?g=e:(c.type(e,"object","invalid arguments for elements"),"data"in e&&(g=e.data,c(Array.isArray(g)||r(g)||d(g),"invalid data for element buffer")),"usage"in e&&(c.parameter(e.usage,m,"invalid element buffer usage"),n=m[e.usage]),"primitive"in e&&(c.parameter(e.primitive,
h,"invalid element buffer primitive"),p=h[e.primitive]),"count"in e&&(c("number"===typeof e.count&&0<=e.count,"invalid vertex count for elements"),k=e.count|0),"length"in e&&(u=e.length|0),"type"in e&&(c.parameter(e.type,F,"invalid buffer type"),w=F[e.type]));g?l(a,g,n,p,k,u,w):(e=a.buffer,e.bind(),b.bufferData(34963,u,n),e.dtype=w||5121,e.usage=n,e.dimension=3,e.byteLength=u,a.primType=0>p?4:p,a.vertCount=0>k?0:k,a.type=e.dtype)}else f(),a.primType=4,a.vertCount=0,a.type=5121;return y}var f=p.create(null,
34963,!0),a=new g(f._buffer);z.elementsCount++;y(k);y._reglType="elements";y._elements=a;y.subdata=function(a,b){f.subdata(a,b);return y};y.destroy=function(){n(a)};return y},createStream:function(b){var c=y.pop();c||(c=new g(p.create(null,34963,!0,!1)._buffer));l(c,b,35040,-1,-1,0,0);return c},destroyStream:function(b){y.push(b)},getElements:function(b){return"function"===typeof b&&b._elements instanceof g?b._elements:null},clear:function(){w(I).forEach(n)}}}},{"./constants/primitives.json":8,"./constants/usage.json":9,
"./util/check":23,"./util/is-ndarray":28,"./util/is-typed-array":29,"./util/values":34}],13:[function(k,t,B){var c=k("./util/check");t.exports=function(k,d){function w(b){c.type(b,"string","extension name must be string");b=b.toLowerCase();var d;try{d=h[b]=k.getExtension(b)}catch(m){}return!!d}for(var h={},m=0;m<d.extensions.length;++m){var b=d.extensions[m];if(!w(b))return d.onDestroy(),d.onDone('"'+b+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),
null}d.optionalExtensions.forEach(w);return{extensions:h,restore:function(){Object.keys(h).forEach(function(b){if(!w(b))throw Error("(regl): error restoring extension "+b);})}}}},{"./util/check":23}],14:[function(k,t,B){var c=k("./util/check"),r=k("./util/values"),d=k("./util/extend"),w=[6408],h=[];h[6408]=4;var m=[];m[5121]=1;m[5126]=4;m[36193]=2;var b=[32854,32855,36194,35907,34842,34843,34836],A={36053:"complete",36054:"incomplete attachment",36057:"incomplete dimensions",36055:"incomplete, missing attachment",
36061:"unsupported"};t.exports=function(p,k,g,l,n,I){function t(a,b,c){this.target=a;this.texture=b;this.renderbuffer=c;var e=a=0;b?(a=b.width,e=b.height):c&&(a=c.width,e=c.height);this.width=a;this.height=e}function F(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function y(a,b,e){if(a){if(a.texture){a=a.texture._texture;var d=Math.max(1,a.height);c(Math.max(1,a.width)===b&&d===e,"inconsistent width/height for supplied texture")}else a=a.renderbuffer._renderbuffer,
c(a.width===b&&a.height===e,"inconsistent width/height for renderbuffer");a.refCount+=1}}function u(a,b){b?b.texture?p.framebufferTexture2D(36160,a,b.target,b.texture._texture.texture,0):p.framebufferRenderbuffer(36160,a,36161,b.renderbuffer._renderbuffer.renderbuffer):p.framebufferTexture2D(36160,a,3553,null,0)}function D(a){var b=3553,e=null,d=null,f=a;"object"===typeof a&&(f=a.data,"target"in a&&(b=a.target|0));c.type(f,"function","invalid attachment data");a=f._reglType;"texture2d"===a?(e=f,c(3553===
b)):"textureCube"===a?(e=f,c(34069<=b&&34075>b,"invalid cube map target")):"renderbuffer"===a?(d=f,b=36161):c.raise("invalid regl object for attachment");return new t(b,e,d)}function G(a,b,c,e,d){if(c)return a=l.create2D({width:a,height:b,format:e,type:d}),a._texture.refCount=0,new t(3553,a,null);a=n.create({width:a,height:b,format:e});a._renderbuffer.refCount=0;return new t(36161,null,a)}function f(a){return a&&(a.texture||a.renderbuffer)}function a(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&
a.renderbuffer.resize(b,c))}function e(){this.id=ha++;ca[this.id]=this;this.framebuffer=p.createFramebuffer();this.height=this.width=0;this.colorAttachments=[];this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function S(a){a.colorAttachments.forEach(F);F(a.depthAttachment);F(a.stencilAttachment);F(a.depthStencilAttachment)}function R(a){var b=a.framebuffer;c(b,"must not double destroy framebuffer");p.deleteFramebuffer(b);a.framebuffer=null;I.framebufferCount--;delete ca[a.id]}
function xa(a){var b;p.bindFramebuffer(36160,a.framebuffer);var e=a.colorAttachments;for(b=0;b<e.length;++b)u(36064+b,e[b]);for(b=e.length;b<g.maxColorAttachments;++b)u(36064+b,null);u(36096,a.depthAttachment);u(36128,a.stencilAttachment);u(33306,a.depthStencilAttachment);a=p.checkFramebufferStatus(36160);36053!==a&&c.raise("framebuffer configuration not supported, status = "+A[a]);p.bindFramebuffer(36160,V.next);V.cur=V.next;p.getError()}function N(l,n){function p(a,e){var d;c(V.next!==r,"can not update framebuffer which is currently in use");
var l=k.webgl_draw_buffers,n=0,u=0,v=!0,A=!0;d=null;var I=!0,t="rgba",K="uint8",R=1,F=null,N=null,ha=null,ca=!1;if("number"===typeof a)n=a|0,u=e|0||n;else if(a){c.type(a,"object","invalid arguments for framebuffer");"shape"in a?(u=a.shape,c(Array.isArray(u)&&2<=u.length,"invalid shape for framebuffer"),n=u[0],u=u[1]):("radius"in a&&(n=u=a.radius),"width"in a&&(n=a.width),"height"in a&&(u=a.height));if("color"in a||"colors"in a)d=a.color||a.colors,Array.isArray(d)&&c(1===d.length||l,"multiple render targets not supported");
if(!d){"colorCount"in a&&(R=a.colorCount|0,c(0<R,"invalid color buffer count"));"colorTexture"in a&&(I=!!a.colorTexture,t="rgba4");if("colorType"in a){K=a.colorType;if(I)c(k.oes_texture_float||!("float"===K||"float32"===K),"you must enable OES_texture_float in order to use floating point framebuffer objects"),c(k.oes_texture_half_float||!("half float"===K||"float16"===K),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects");else if("half float"===K||"float16"===
K)c(k.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),t="rgba16f";else if("float"===K||"float32"===K)c(k.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),t="rgba32f";c.oneOf(K,B,"invalid color type")}if("colorFormat"in a)if(t=a.colorFormat,0<=O.indexOf(t))I=!0;else if(0<=C.indexOf(t))I=!1;else if(I)c.oneOf(a.colorFormat,O,"invalid color format for texture");else c.oneOf(a.colorFormat,
C,"invalid color format for renderbuffer")}if("depthTexture"in a||"depthStencilTexture"in a)ca=!(!a.depthTexture&&!a.depthStencilTexture),c(!ca||k.webgl_depth_texture,"webgl_depth_texture extension not supported");"depth"in a&&("boolean"===typeof a.depth?v=a.depth:(F=a.depth,A=!1));"stencil"in a&&("boolean"===typeof a.stencil?A=a.stencil:(N=a.stencil,v=!1));"depthStencil"in a&&("boolean"===typeof a.depthStencil?v=A=a.depthStencil:(ha=a.depthStencil,A=v=!1))}else n=u=1;var M,U=l=null,H=null;if(Array.isArray(d))M=
d.map(D);else if(d)M=[D(d)];else for(M=Array(R),d=0;d<R;++d)M[d]=G(n,u,I,t,K);c(k.webgl_draw_buffers||1>=M.length,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers.");c(M.length<=g.maxColorAttachments,"too many color attachments, not supported");n=n||M[0].width;u=u||M[0].height;F?l=D(F):v&&!A&&(l=G(n,u,ca,"depth","uint32"));N?U=D(N):A&&!v&&(U=G(n,u,!1,"stencil","uint8"));ha?H=D(ha):!F&&!N&&A&&v&&(H=G(n,u,ca,"depth stencil","depth stencil"));c(1>=!!F+!!N+!!ha,
"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");v=null;for(d=0;d<M.length;++d)y(M[d],n,u),c(!M[d]||M[d].texture&&0<=w.indexOf(M[d].texture._texture.format)||M[d].renderbuffer&&0<=b.indexOf(M[d].renderbuffer._renderbuffer.format),"framebuffer color attachment "+d+" is invalid"),M[d]&&M[d].texture&&(A=h[M[d].texture._texture.format]*m[M[d].texture._texture.type],null===v?v=A:c(v===A,"all color attachments much have the same number of bits per pixel."));y(l,n,u);
c(!l||l.texture&&6402===l.texture._texture.format||l.renderbuffer&&33189===l.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object");y(U,n,u);c(!U||U.renderbuffer&&36168===U.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object");y(H,n,u);c(!H||H.texture&&34041===H.texture._texture.format||H.renderbuffer&&34041===H.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object");S(r);r.width=n;r.height=u;r.colorAttachments=
M;r.depthAttachment=l;r.stencilAttachment=U;r.depthStencilAttachment=H;p.color=M.map(f);p.depth=f(l);p.stencil=f(U);p.depthStencil=f(H);p.width=r.width;p.height=r.height;xa(r);return p}var r=new e;I.framebufferCount++;p(l,n);return d(p,{resize:function(b,e){c(V.next!==r,"can not resize a framebuffer which is currently in use");var d=b|0,f=e|0||d;if(d===r.width&&f===r.height)return p;for(var g=r.colorAttachments,l=0;l<g.length;++l)a(g[l],d,f);a(r.depthAttachment,d,f);a(r.stencilAttachment,d,f);a(r.depthStencilAttachment,
d,f);r.width=p.width=d;r.height=p.height=f;xa(r);return p},_reglType:"framebuffer",_framebuffer:r,destroy:function(){R(r);S(r)}})}var V={cur:null,next:null,dirty:!1},O=["rgba"],C=["rgba4","rgb565","rgb5 a1"];k.ext_srgb&&C.push("srgba");k.ext_color_buffer_half_float&&C.push("rgba16f","rgb16f");k.webgl_color_buffer_float&&C.push("rgba32f");var B=["uint8"];k.oes_texture_half_float&&B.push("half float","float16");k.oes_texture_float&&B.push("float","float32");var ha=0,ca={};return d(V,{getFramebuffer:function(a){return"function"===
typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer,a instanceof e)?a:null},create:N,createCube:function(a){function b(a){var f;c(0>e.indexOf(V.next),"can not update framebuffer which is currently in use");var g=k.webgl_draw_buffers,h={color:null},n=0,m=null;f="rgba";var p="uint8",r=1;if("number"===typeof a)n=a|0;else if(a){c.type(a,"object","invalid arguments for framebuffer");"shape"in a?(n=a.shape,c(Array.isArray(n)&&2<=n.length,"invalid shape for framebuffer"),c(n[0]===n[1],"cube framebuffer must be square"),
n=n[0]):("radius"in a&&(n=a.radius|0),"width"in a?(n=a.width|0,"height"in a&&c(a.height===n,"must be square")):"height"in a&&(n=a.height|0));if("color"in a||"colors"in a)m=a.color||a.colors,Array.isArray(m)&&c(1===m.length||g,"multiple render targets not supported");m||("colorCount"in a&&(r=a.colorCount|0,c(0<r,"invalid color buffer count")),"colorType"in a&&(c.oneOf(a.colorType,B,"invalid color type"),p=a.colorType),"colorFormat"in a&&(f=a.colorFormat,c.oneOf(a.colorFormat,O,"invalid color format for texture")));
"depth"in a&&(h.depth=a.depth);"stencil"in a&&(h.stencil=a.stencil);"depthStencil"in a&&(h.depthStencil=a.depthStencil)}else n=1;if(m)if(Array.isArray(m))for(a=[],f=0;f<m.length;++f)a[f]=m[f];else a=[m];else for(a=Array(r),m={radius:n,format:f,type:p},f=0;f<r;++f)a[f]=l.createCube(m);h.color=Array(a.length);for(f=0;f<a.length;++f)r=a[f],c("function"===typeof r&&"textureCube"===r._reglType,"invalid cube map"),n=n||r.width,c(r.width===n&&r.height===n,"invalid cube map shape"),h.color[f]={target:34069,
data:a[f]};for(f=0;6>f;++f){for(r=0;r<a.length;++r)h.color[r].target=34069+f;0<f&&(h.depth=e[0].depth,h.stencil=e[0].stencil,h.depthStencil=e[0].depthStencil);if(e[f])e[f](h);else e[f]=N(h)}return d(b,{width:n,height:n,color:a})}var e=Array(6);b(a);return d(b,{faces:e,resize:function(a){var d=a|0;c(0<d&&d<=g.maxCubeMapSize,"invalid radius for cube fbo");if(d===b.width)return b;var f=b.color;for(a=0;a<f.length;++a)f[a].resize(d);for(a=0;6>a;++a)e[a].resize(d);b.width=b.height=d;return b},_reglType:"framebufferCube",
destroy:function(){e.forEach(function(a){a.destroy()})}})},clear:function(){r(ca).forEach(R)},restore:function(){r(ca).forEach(function(a){a.framebuffer=p.createFramebuffer();xa(a)})}})}},{"./util/check":23,"./util/extend":26,"./util/values":34}],15:[function(k,t,B){t.exports=function(c,r){var d=1;r.ext_texture_filter_anisotropic&&(d=c.getParameter(34047));var k=1,h=1;r.webgl_draw_buffers&&(k=c.getParameter(34852),h=c.getParameter(36063));return{colorBits:[c.getParameter(3410),c.getParameter(3411),
c.getParameter(3412),c.getParameter(3413)],depthBits:c.getParameter(3414),stencilBits:c.getParameter(3415),subpixelBits:c.getParameter(3408),extensions:Object.keys(r).filter(function(c){return!!r[c]}),maxAnisotropic:d,maxDrawbuffers:k,maxColorAttachments:h,pointSizeDims:c.getParameter(33901),lineWidthDims:c.getParameter(33902),maxViewportDims:c.getParameter(3386),maxCombinedTextureUnits:c.getParameter(35661),maxCubeMapSize:c.getParameter(34076),maxRenderbufferSize:c.getParameter(34024),maxTextureUnits:c.getParameter(34930),
maxTextureSize:c.getParameter(3379),maxAttributes:c.getParameter(34921),maxVertexUniforms:c.getParameter(36347),maxVertexTextureUnits:c.getParameter(35660),maxVaryingVectors:c.getParameter(36348),maxFragmentUniforms:c.getParameter(36349),glsl:c.getParameter(35724),renderer:c.getParameter(7937),vendor:c.getParameter(7936),version:c.getParameter(7938)}}},{}],16:[function(k,t,B){var c=k("./util/check"),r=k("./util/is-typed-array");t.exports=function(d,k,h,m,b,A){return function(p){var z;null===k.next?
(c(b.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),z=5121):(c(null!==k.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),z=k.next.colorAttachments[0].texture._texture.type,A.oes_texture_float?c(5121===z||5126===z,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"):c(5121===z,"Reading from a framebuffer is only allowed for the type 'uint8'"));var g=0,l=0,n=
m.framebufferWidth,I=m.framebufferHeight,t=null;r(p)?t=p:p&&(c.type(p,"object","invalid arguments to regl.read()"),g=p.x|0,l=p.y|0,c(0<=g&&g<m.framebufferWidth,"invalid x offset for regl.read"),c(0<=l&&l<m.framebufferHeight,"invalid y offset for regl.read"),n=(p.width||m.framebufferWidth-g)|0,I=(p.height||m.framebufferHeight-l)|0,t=p.data||null);t&&(5121===z?c(t instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):5126===z&&c(t instanceof Float32Array,
"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'"));c(0<n&&n+g<=m.framebufferWidth,"invalid width for read pixels");c(0<I&&I+l<=m.framebufferHeight,"invalid height for read pixels");h();p=n*I*4;t||(5121===z?t=new Uint8Array(p):5126===z&&(t=t||new Float32Array(p)));c.isTypedArray(t,"data buffer for regl.read() must be a typedarray");c(t.byteLength>=p,"data buffer for regl.read() too small");d.pixelStorei(3333,4);d.readPixels(g,l,n,I,6408,z,t);return t}}},{"./util/check":23,
"./util/is-typed-array":29}],17:[function(k,t,B){var c=k("./util/check"),r=k("./util/values"),d=[];d[32854]=2;d[32855]=2;d[36194]=2;d[33189]=2;d[36168]=1;d[34041]=4;d[35907]=4;d[34836]=16;d[34842]=8;d[34843]=6;t.exports=function(k,h,m,b,t){function p(b){this.id=l++;this.refCount=1;this.renderbuffer=b;this.format=32854;this.height=this.width=0;t.profile&&(this.stats={size:0})}function z(d){var g=d.renderbuffer;c(g,"must not double destroy renderbuffer");k.bindRenderbuffer(36161,null);k.deleteRenderbuffer(g);
d.renderbuffer=null;d.refCount=0;delete n[d.id];b.renderbufferCount--}var g={rgba4:32854,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};h.ext_srgb&&(g.srgba=35907);h.ext_color_buffer_half_float&&(g.rgba16f=34842,g.rgb16f=34843);h.webgl_color_buffer_float&&(g.rgba32f=34836);var l=0,n={};p.prototype.decRef=function(){0>=--this.refCount&&z(this)};t.profile&&(b.getTotalRenderbufferSize=function(){var b=0;Object.keys(n).forEach(function(c){b+=n[c].stats.size});return b});
return{create:function(l,h){function r(b,l){var h=0,f=0,a=32854;"object"===typeof b&&b?("shape"in b?(f=b.shape,c(Array.isArray(f)&&2<=f.length,"invalid renderbuffer shape"),h=f[0]|0,f=f[1]|0):("radius"in b&&(h=f=b.radius|0),"width"in b&&(h=b.width|0),"height"in b&&(f=b.height|0)),"format"in b&&(c.parameter(b.format,g,"invalid renderbuffer format"),a=g[b.format])):"number"===typeof b?(h=b|0,f="number"===typeof l?l|0:h):b?c.raise("invalid arguments to renderbuffer constructor"):h=f=1;c(0<h&&0<f&&h<=
m.maxRenderbufferSize&&f<=m.maxRenderbufferSize,"invalid renderbuffer size");if(h!==y.width||f!==y.height||a!==y.format)return r.width=y.width=h,r.height=y.height=f,y.format=a,k.bindRenderbuffer(36161,y.renderbuffer),k.renderbufferStorage(36161,a,h,f),t.profile&&(y.stats.size=d[y.format]*y.width*y.height),r}var y=new p(k.createRenderbuffer());n[y.id]=y;b.renderbufferCount++;r(l,h);r.resize=function(b,g){var h=b|0,f=g|0||h;if(h===y.width&&f===y.height)return r;c(0<h&&0<f&&h<=m.maxRenderbufferSize&&
f<=m.maxRenderbufferSize,"invalid renderbuffer size");r.width=y.width=h;r.height=y.height=f;k.bindRenderbuffer(36161,y.renderbuffer);k.renderbufferStorage(36161,y.format,h,f);t.profile&&(y.stats.size=d[y.format]*y.width*y.height);return r};r._reglType="renderbuffer";r._renderbuffer=y;t.profile&&(r.stats=y.stats);r.destroy=function(){y.decRef()};return r},clear:function(){r(n).forEach(z)},restore:function(){r(n).forEach(function(b){b.renderbuffer=k.createRenderbuffer();k.bindRenderbuffer(36161,b.renderbuffer);
k.renderbufferStorage(36161,b.format,b.width,b.height)});k.bindRenderbuffer(36161,null)}}}},{"./util/check":23,"./util/values":34}],18:[function(k,t,B){var c=k("./util/check"),r=k("./util/values");t.exports=function(d,k,h,m){function b(b,c,d,g){this.name=b;this.id=c;this.location=d;this.info=g}function t(b,c){for(var d=0;d<b.length;++d)if(b[d].id===c.id){b[d].location=c.location;return}b.push(c)}function p(b,g,h){var m=35632===b?l:n,f=m[g];if(!f){var a=k.str(g),f=d.createShader(b);d.shaderSource(f,
a);d.compileShader(f);c.shaderError(d,f,a,b,h);m[g]=f}return f}function z(b,c){this.id=F++;this.fragId=b;this.vertId=c;this.program=null;this.uniforms=[];this.attributes=[];m.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function g(g,h){var l,n;l=p(35632,g.fragId);n=p(35633,g.vertId);var f=g.program=d.createProgram();d.attachShader(f,l);d.attachShader(f,n);d.linkProgram(f);c.linkError(d,f,k.str(g.fragId),k.str(g.vertId),h);var a=d.getProgramParameter(f,35718);m.profile&&(g.stats.uniformsCount=
a);var e=g.uniforms;for(l=0;l<a;++l)if(n=d.getActiveUniform(f,l))if(1<n.size)for(var r=0;r<n.size;++r){var z=n.name.replace("[0]","["+r+"]");t(e,new b(z,k.id(z),d.getUniformLocation(f,z),n))}else t(e,new b(n.name,k.id(n.name),d.getUniformLocation(f,n.name),n));a=d.getProgramParameter(f,35721);m.profile&&(g.stats.attributesCount=a);e=g.attributes;for(l=0;l<a;++l)(n=d.getActiveAttrib(f,l))&&t(e,new b(n.name,k.id(n.name),d.getAttribLocation(f,n.name),n))}var l={},n={},I={},K=[],F=0;m.profile&&(h.getMaxUniformsCount=
function(){var b=0;K.forEach(function(c){c.stats.uniformsCount>b&&(b=c.stats.uniformsCount)});return b},h.getMaxAttributesCount=function(){var b=0;K.forEach(function(c){c.stats.attributesCount>b&&(b=c.stats.attributesCount)});return b});return{clear:function(){var b=d.deleteShader.bind(d);r(l).forEach(b);l={};r(n).forEach(b);n={};K.forEach(function(b){d.deleteProgram(b.program)});K.length=0;I={};h.shaderCount=0},program:function(b,d,l){c.command(0<=b,"missing vertex shader",l);c.command(0<=d,"missing fragment shader",
l);h.shaderCount++;var n=I[d];n||(n=I[d]={});var f=n[b];f||(f=new z(d,b),g(f,l),n[b]=f,K.push(f));return f},restore:function(){l={};n={};for(var b=0;b<K.length;++b)g(K[b])},shader:p,frag:-1,vert:-1}}},{"./util/check":23,"./util/values":34}],19:[function(k,t,B){t.exports=function(){return{bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}},{}],20:[function(k,t,B){t.exports=function(){var c={"":0},r=[""];return{id:function(d){var k=
c[d];if(k)return k;k=c[d]=r.length;r.push(d);return k},str:function(c){return r[c]}}}},{}],21:[function(k,t,B){function c(a){return Array.isArray(a)&&(0===a.length||"number"===typeof a[0])}function r(a){return Array.isArray(a)&&0!==a.length&&I(a[0])?!0:!1}function d(a){return Object.prototype.toString.call(a)}function w(a){if(!a)return!1;var b=d(a);return 0<=D.indexOf(b)?!0:c(a)||r(a)||g(a)}function h(a,b){36193===a.type?(a.data=n(b),l.freeType(b)):a.data=b}function m(a,b,c,d,g,l){a="undefined"!==
typeof f[a]?f[a]:u[a]*G[b];l&&(a*=6);if(g){for(d=0;1<=c;)d+=a*c*c,c/=2;return d}return a*c*d}var b=k("./util/check"),A=k("./util/extend"),p=k("./util/values"),z=k("./util/is-typed-array"),g=k("./util/is-ndarray"),l=k("./util/pool"),n=k("./util/to-half-float"),I=k("./util/is-array-like");B=k("./constants/arraytypes.json");var K=k("./constants/arraytypes.json"),F=[9984,9986,9985,9987],y=[0,6409,6410,6407,6408],u={};u[6409]=u[6406]=u[6402]=1;u[34041]=u[6410]=2;u[6407]=u[35904]=3;u[6408]=u[35906]=4;var D=
Object.keys(B).concat(["[object HTMLCanvasElement]","[object CanvasRenderingContext2D]","[object HTMLImageElement]","[object HTMLVideoElement]"]),G=[];G[5121]=1;G[5126]=4;G[36193]=2;G[5123]=2;G[5125]=4;var f=[];f[32854]=2;f[32855]=2;f[36194]=2;f[34041]=4;f[33776]=.5;f[33777]=.5;f[33778]=1;f[33779]=1;f[35986]=.5;f[35987]=1;f[34798]=1;f[35840]=.5;f[35841]=.25;f[35842]=.5;f[35843]=.25;f[36196]=.5;t.exports=function(a,e,f,k,t,N,D){function O(){this.format=this.internalformat=6408;this.type=5121;this.flipY=
this.premultiplyAlpha=this.compressed=!1;this.unpackAlignment=1;this.height=this.width=this.colorSpace=0;this.channels=4}function C(a,b){a.internalformat=b.internalformat;a.format=b.format;a.type=b.type;a.compressed=b.compressed;a.premultiplyAlpha=b.premultiplyAlpha;a.flipY=b.flipY;a.unpackAlignment=b.unpackAlignment;a.colorSpace=b.colorSpace;a.width=b.width;a.height=b.height;a.channels=b.channels}function B(a,c){if("object"===typeof c&&c){"premultiplyAlpha"in c&&(b.type(c.premultiplyAlpha,"boolean",
"invalid premultiplyAlpha"),a.premultiplyAlpha=c.premultiplyAlpha);"flipY"in c&&(b.type(c.flipY,"boolean","invalid texture flip"),a.flipY=c.flipY);"alignment"in c&&(b.oneOf(c.alignment,[1,2,4,8],"invalid texture unpack alignment"),a.unpackAlignment=c.alignment);"colorSpace"in c&&(b.parameter(c.colorSpace,Z,"invalid colorSpace"),a.colorSpace=Z[c.colorSpace]);if("type"in c){var d=c.type;b(e.oes_texture_float||!("float"===d||"float32"===d),"you must enable the OES_texture_float extension in order to use floating point textures.");
b(e.oes_texture_half_float||!("half float"===d||"float16"===d),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures.");b(e.webgl_depth_texture||!("depth"===d||"depth stencil"===d),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures.");b.parameter(d,H,"invalid texture type");a.type=H[d]}var g=a.width,l=a.height,h=a.channels,d=!1;"shape"in c?(b(Array.isArray(c.shape)&&2<=c.shape.length,"shape must be an array"),g=
c.shape[0],l=c.shape[1],3===c.shape.length&&(h=c.shape[2],b(0<h&&4>=h,"invalid number of channels"),d=!0),b(0<=g&&g<=f.maxTextureSize,"invalid width"),b(0<=l&&l<=f.maxTextureSize,"invalid height")):("radius"in c&&(g=l=c.radius,b(0<=g&&g<=f.maxTextureSize,"invalid radius")),"width"in c&&(g=c.width,b(0<=g&&g<=f.maxTextureSize,"invalid width")),"height"in c&&(l=c.height,b(0<=l&&l<=f.maxTextureSize,"invalid height")),"channels"in c&&(h=c.channels,b(0<h&&4>=h,"invalid number of channels"),d=!0));a.width=
g|0;a.height=l|0;a.channels=h|0;g=!1;"format"in c&&(g=c.format,b(e.webgl_depth_texture||!("depth"===g||"depth stencil"===g),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),b.parameter(g,ba,"invalid texture format"),l=a.internalformat=ba[g],a.format=qa[l],g in H&&!("type"in c)&&(a.type=H[g]),g in aa&&(a.compressed=!0),g=!0);!d&&g?a.channels=u[a.format]:d&&!g?a.channels!==y[a.format]&&(a.format=a.internalformat=y[a.channels]):g&&d&&b(a.channels===u[a.format],
"number of channels inconsistent with specified format")}}function ha(b){a.pixelStorei(37440,b.flipY);a.pixelStorei(37441,b.premultiplyAlpha);a.pixelStorei(37443,b.colorSpace);a.pixelStorei(3317,b.unpackAlignment)}function G(){O.call(this);this.yOffset=this.xOffset=0;this.data=null;this.needsFree=!1;this.element=null;this.needsCopy=!1}function v(a,e){var m=null;w(e)?m=e:e&&(b.type(e,"object","invalid pixel data type"),B(a,e),"x"in e&&(a.xOffset=e.x|0),"y"in e&&(a.yOffset=e.y|0),w(e.data)&&(m=e.data));
b(!a.compressed||m instanceof Uint8Array,"compressed texture data must be stored in a uint8array");if(e.copy){b(!m,"can not specify copy and data field for the same texture");var p=t.viewportWidth,k=t.viewportHeight;a.width=a.width||p-a.xOffset;a.height=a.height||k-a.yOffset;a.needsCopy=!0;b(0<=a.xOffset&&a.xOffset<p&&0<=a.yOffset&&a.yOffset<k&&0<a.width&&a.width<=p&&0<a.height&&a.height<=k,"copy texture read out of bounds")}else if(!m)a.width=a.width||1,a.height=a.height||1;else if(z(m))a.data=m,
"type"in e||5121!==a.type||(a.type=K[Object.prototype.toString.call(m)]|0);else if(c(m)){p=m;k=a.width*a.height*a.channels;b(p.length===k,"inconsistent array length for texture. Expected: "+k+". Was: "+p.length);switch(a.type){case 5121:case 5123:case 5125:case 5126:k=l.allocType(a.type,k);k.set(p);a.data=k;break;case 36193:a.data=n(p);break;default:b.raise("unsupported texture type, must specify a typed array")}a.alignment=1;a.needsFree=!0}else if(g(m)){p=m.data;Array.isArray(p)||5121!==a.type||
(a.type=K[Object.prototype.toString.call(p)]|0);var k=m.shape,u=m.stride,v,A,D,C;3===k.length?(D=k[2],C=u[2]):(b(2===k.length,"invalid ndarray pixel data, must be 2 or 3D"),C=D=1);v=k[0];A=k[1];k=u[0];u=u[1];a.alignment=1;a.width=v;a.height=A;a.channels=D;a.format=a.internalformat=y[D];a.needsFree=!0;v=C;m=m.offset;D=a.width;C=a.height;A=a.channels;for(var R=l.allocType(36193===a.type?5126:a.type,D*C*A),N=0,O=0;O<C;++O)for(var F=0;F<D;++F)for(var qa=0;qa<A;++qa)R[N++]=p[k*F+u*O+v*qa+m];h(a,R)}else if("[object HTMLCanvasElement]"===
d(m)||"[object CanvasRenderingContext2D]"===d(m))"[object HTMLCanvasElement]"===d(m)?a.element=m:a.element=m.canvas,a.width=a.element.width,a.height=a.element.height;else if("[object HTMLImageElement]"===d(m))a.element=m,a.width=m.naturalWidth,a.height=m.naturalHeight;else if("[object HTMLVideoElement]"===d(m))a.element=m,a.width=m.videoWidth,a.height=m.videoHeight,a.needsPoll=!0;else if(r(m)){p=m[0].length;k=m.length;u=1;if(I(m[0][0])){v=u=m[0][0].length;D=l.allocType(36193===a.type?5126:a.type,
p*k*v);for(A=C=0;A<k;++A)for(R=m[A],N=0;N<p;++N)for(O=R[N],F=0;F<v;++F)D[C++]=O[F];h(a,D)}else{v=l.allocType(36193===a.type?5126:a.type,p*k);for(C=D=0;C<k;++C)for(A=m[C],R=0;R<p;++R)v[D++]=A[R];h(a,v)}a.alignment=1;a.width=p;a.height=k;a.channels=u;a.format=a.internalformat=y[u];a.needsFree=!0}5126===a.type?b(0<=f.extensions.indexOf("oes_texture_float"),"oes_texture_float extension not enabled"):36193===a.type&&b(0<=f.extensions.indexOf("oes_texture_half_float"),"oes_texture_half_float extension not enabled")}
function U(b,c,e,d,f){var g=b.element,l=b.data,h=b.internalformat,n=b.format,m=b.type,p=b.width,r=b.height;ha(b);g?a.texSubImage2D(c,f,e,d,n,m,g):b.compressed?a.compressedTexSubImage2D(c,f,e,d,h,p,r,l):b.needsCopy?(k(),a.copyTexSubImage2D(c,f,e,d,b.xOffset,b.yOffset,p,r)):a.texSubImage2D(c,f,e,d,p,r,n,m,l)}function ia(){return Ca.pop()||new G}function ra(a){a.needsFree&&l.freeType(a.data);G.call(a);Ca.push(a)}function na(){O.call(this);this.genMipmaps=!1;this.mipmapHint=4352;this.mipmask=0;this.images=
Array(16)}function da(a,b,c){var e=a.images[0]=ia();a.mipmask=1;e.width=a.width=b;e.height=a.height=c}function Q(a,c){var e;if(w(c))e=a.images[0]=ia(),C(e,a),v(e,c),a.mipmask=1;else if(B(a,c),Array.isArray(c.mipmap))for(var d=c.mipmap,f=0;f<d.length;++f)e=a.images[f]=ia(),C(e,a),e.width>>=f,e.height>>=f,v(e,d[f]),a.mipmask|=1<<f;else e=a.images[0]=ia(),C(e,a),v(e,c),a.mipmask=1;C(a,a.images[0]);(a.compressed&&33776===a.internalformat||33777===a.internalformat||33778===a.internalformat||33779===a.internalformat)&&
b(0===a.width%4&&0===a.height%4,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function P(b,c){for(var e=b.images,d=0;d<e.length&&e[d];++d){var f=e[d],g=c,l=d,h=f.element,n=f.data,m=f.internalformat,p=f.format,r=f.type,u=f.width,t=f.height;ha(f);h?a.texImage2D(g,l,p,p,r,h):f.compressed?a.compressedTexImage2D(g,l,m,u,t,0,n):f.needsCopy?(k(),a.copyTexImage2D(g,l,p,f.xOffset,f.yOffset,u,t,0)):a.texImage2D(g,l,p,u,t,0,p,r,n)}}function T(){var a=Da.pop()||
new na;O.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function ja(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&ra(b[c]),b[c]=null;Da.push(a)}function sa(){this.magFilter=this.minFilter=9728;this.wrapT=this.wrapS=33071;this.anisotropic=1;this.genMipmaps=!1;this.mipmapHint=4352}function Y(a,c){if("min"in c){var e=c.min;b.parameter(e,M);a.minFilter=M[e];0<=F.indexOf(a.minFilter)&&(a.genMipmaps=!0)}"mag"in c&&(e=c.mag,b.parameter(e,ea),a.magFilter=ea[e]);var e=a.wrapS,d=a.wrapT;
if("wrap"in c){var g=c.wrap;"string"===typeof g?(b.parameter(g,X),e=d=X[g]):Array.isArray(g)&&(b.parameter(g[0],X),b.parameter(g[1],X),e=X[g[0]],d=X[g[1]])}else"wrapS"in c&&(e=c.wrapS,b.parameter(e,X),e=X[e]),"wrapT"in c&&(d=c.wrapT,b.parameter(d,X),d=X[d]);a.wrapS=e;a.wrapT=d;"anisotropic"in c&&(e=c.anisotropic,b("number"===typeof e&&1<=e&&e<=f.maxAnisotropic,"aniso samples must be between 1 and "),a.anisotropic=c.anisotropic);if("mipmap"in c){e=!1;switch(typeof c.mipmap){case "string":b.parameter(c.mipmap,
ta,"invalid mipmap hint");a.mipmapHint=ta[c.mipmap];e=a.genMipmaps=!0;break;case "boolean":e=a.genMipmaps=c.mipmap;break;case "object":b(Array.isArray(c.mipmap),"invalid mipmap type");a.genMipmaps=!1;e=!0;break;default:b.raise("invalid mipmap type")}!e||"min"in c||(a.minFilter=9984)}}function ga(b,c){a.texParameteri(c,10241,b.minFilter);a.texParameteri(c,10240,b.magFilter);a.texParameteri(c,10242,b.wrapS);a.texParameteri(c,10243,b.wrapT);e.ext_texture_filter_anisotropic&&a.texParameteri(c,34046,b.anisotropic);
b.genMipmaps&&(a.hint(33170,b.mipmapHint),a.generateMipmap(c))}function ka(b){O.call(this);this.mipmask=0;this.internalformat=6408;this.id=Ka++;this.refCount=1;this.target=b;this.texture=a.createTexture();this.unit=-1;this.bindCount=0;this.texInfo=new sa;D.profile&&(this.stats={size:0})}function la(b){a.activeTexture(33984);a.bindTexture(b.target,b.texture)}function ma(){var b=wa[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function pa(c){var e=c.texture;b(e,"must not double destroy texture");
var d=c.unit,f=c.target;0<=d&&(a.activeTexture(33984+d),a.bindTexture(f,null),wa[d]=null);a.deleteTexture(e);c.texture=null;c.params=null;c.pixels=null;c.refCount=0;delete va[c.id];N.textureCount--}var ta={"don't care":4352,"dont care":4352,nice:4354,fast:4353},X={repeat:10497,clamp:33071,mirror:33648},ea={nearest:9728,linear:9729},M=A({"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987,mipmap:9987},ea),Z={none:0,browser:37444},H={uint8:5121,
rgba4:32819,rgb565:33635,"rgb5 a1":32820},ba={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},aa={};e.ext_srgb&&(ba.srgb=35904,ba.srgba=35906);e.oes_texture_float&&(H.float32=H["float"]=5126);e.oes_texture_half_float&&(H.float16=H["half float"]=36193);e.webgl_depth_texture&&(A(ba,{depth:6402,"depth stencil":34041}),A(H,{uint16:5123,uint32:5125,"depth stencil":34042}));e.webgl_compressed_texture_s3tc&&A(aa,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,
"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779});e.webgl_compressed_texture_atc&&A(aa,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798});e.webgl_compressed_texture_pvrtc&&A(aa,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843});e.webgl_compressed_texture_etc1&&(aa["rgb etc1"]=36196);var ua=Array.prototype.slice.call(a.getParameter(34467));Object.keys(aa).forEach(function(a){var b=aa[a];0<=ua.indexOf(b)&&(ba[a]=
b)});var fa=Object.keys(ba);f.textureFormats=fa;var qa=fa.reduce(function(a,b){var c=ba[b];6409===c||6406===c||6409===c||6410===c||6402===c||34041===c?a[c]=c:32855===c||0<=b.indexOf("rgba")?a[c]=6408:a[c]=6407;return a},{}),Ca=[],Da=[],Ka=0,va={},Ea=f.maxTextureUnits,wa=Array(Ea).map(function(){return null});A(ka.prototype,{bind:function(){this.bindCount+=1;var c=this.unit;if(0>c){for(var e=0;e<Ea;++e){var d=wa[e];if(d){if(0<d.bindCount)continue;d.unit=-1}wa[e]=this;c=e;break}c>=Ea&&b.raise("insufficient number of texture units");
D.profile&&N.maxTextureUnits<c+1&&(N.maxTextureUnits=c+1);this.unit=c;a.activeTexture(33984+c);a.bindTexture(this.target,this.texture)}return c},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&pa(this)}});D.profile&&(N.getTotalTextureSize=function(){var a=0;Object.keys(va).forEach(function(b){a+=va[b].stats.size});return a});return{create2D:function(c,e){function d(a,c){var e=g.texInfo;sa.call(e);var l=T();"number"===typeof a?"number"===typeof c?da(l,a|0,c|0):da(l,a|0,a|
0):a?(b.type(a,"object","invalid arguments to regl.texture"),Y(e,a),Q(l,a)):da(l,1,1);e.genMipmaps&&(l.mipmask=(l.width<<1)-1);g.mipmask=l.mipmask;C(g,l);b.texture2D(e,l,f);g.internalformat=l.internalformat;d.width=l.width;d.height=l.height;la(g);P(l,3553);ga(e,3553);ma();ja(l);D.profile&&(g.stats.size=m(g.internalformat,g.type,l.width,l.height,e.genMipmaps,!1));return d}var g=new ka(3553);va[g.id]=g;N.textureCount++;d(c,e);d.subimage=function(a,c,e,f){b(!!a,"must specify image data");c|=0;e|=0;f|=
0;var l=ia();C(l,g);l.width>>=f;l.height>>=f;l.width-=c;l.height-=e;v(l,a);b(g.type===l.type&&g.format===l.format&&g.internalformat===l.internalformat,"incompatible format for texture.subimage");b(0<=c&&0<=e&&c+l.width<=g.width&&e+l.height<=g.height,"texture.subimage write out of bounds");b(g.mipmask&1<<f,"missing mipmap data");b(l.data||l.element||l.needsCopy,"missing image data");la(g);U(l,3553,c,e,f);ma();ra(l);return d};d.resize=function(b,c){var e=b|0,f=c|0||e;if(e===g.width&&f===g.height)return d;
d.width=g.width=e;d.height=g.height=f;la(g);for(var l=0;g.mipmask>>l;++l)a.texImage2D(3553,l,g.format,e>>l,f>>l,0,g.format,g.type,null);ma();D.profile&&(g.stats.size=m(g.internalformat,g.type,e,f,!1,!1));return d};d._reglType="texture2d";d._texture=g;D.profile&&(d.stats=g.stats);d.destroy=function(){g.decRef()};return d},createCube:function(c,e,d,g,l,h){function n(a,c,e,d,g,l){var h,q=p.texInfo;sa.call(q);for(h=0;6>h;++h)k[h]=T();if("number"!==typeof a&&a)if("object"===typeof a)if(c)Q(k[0],a),Q(k[1],
c),Q(k[2],e),Q(k[3],d),Q(k[4],g),Q(k[5],l);else if(Y(q,a),B(p,a),"faces"in a)for(a=a.faces,b(Array.isArray(a)&&6===a.length,"cube faces must be a length 6 array"),h=0;6>h;++h)b("object"===typeof a[h]&&!!a[h],"invalid input for cube map face"),C(k[h],p),Q(k[h],a[h]);else for(h=0;6>h;++h)Q(k[h],a);else b.raise("invalid arguments to cube map");else for(a=a|0||1,h=0;6>h;++h)da(k[h],a,a);C(p,k[0]);p.mipmask=q.genMipmaps?(k[0].width<<1)-1:k[0].mipmask;b.textureCube(p,q,k,f);p.internalformat=k[0].internalformat;
n.width=k[0].width;n.height=k[0].height;la(p);for(h=0;6>h;++h)P(k[h],34069+h);ga(q,34067);ma();D.profile&&(p.stats.size=m(p.internalformat,p.type,n.width,n.height,q.genMipmaps,!0));for(h=0;6>h;++h)ja(k[h]);return n}var p=new ka(34067);va[p.id]=p;N.cubeCount++;var k=Array(6);n(c,e,d,g,l,h);n.subimage=function(a,c,e,d,f){b(!!c,"must specify image data");b("number"===typeof a&&a===(a|0)&&0<=a&&6>a,"invalid face");e|=0;d|=0;f|=0;var g=ia();C(g,p);g.width>>=f;g.height>>=f;g.width-=e;g.height-=d;v(g,c);
b(p.type===g.type&&p.format===g.format&&p.internalformat===g.internalformat,"incompatible format for texture.subimage");b(0<=e&&0<=d&&e+g.width<=p.width&&d+g.height<=p.height,"texture.subimage write out of bounds");b(p.mipmask&1<<f,"missing mipmap data");b(g.data||g.element||g.needsCopy,"missing image data");la(p);U(g,34069+a,e,d,f);ma();ra(g);return n};n.resize=function(b){b|=0;if(b!==p.width){n.width=p.width=b;n.height=p.height=b;la(p);for(var c=0;6>c;++c)for(var e=0;p.mipmask>>e;++e)a.texImage2D(34069+
c,e,p.format,b>>e,b>>e,0,p.format,p.type,null);ma();D.profile&&(p.stats.size=m(p.internalformat,p.type,n.width,n.height,!1,!0));return n}};n._reglType="textureCube";n._texture=p;D.profile&&(n.stats=p.stats);n.destroy=function(){p.decRef()};return n},clear:function(){for(var b=0;b<Ea;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),wa[b]=null;p(va).forEach(pa);N.cubeCount=0;N.textureCount=0},getTexture:function(a){return null},restore:function(){p(va).forEach(function(b){b.texture=a.createTexture();
a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!==(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var e=0;6>e;++e)a.texImage2D(34069+e,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);ga(b.texInfo,b.target)})}}}},{"./constants/arraytypes.json":6,"./util/check":23,"./util/extend":26,"./util/is-array-like":27,"./util/is-ndarray":28,"./util/is-typed-array":29,"./util/pool":31,
"./util/to-half-float":33,"./util/values":34}],22:[function(k,t,B){t.exports=function(c,k){function d(){this.endQueryIndex=this.startQueryIndex=-1;this.sum=0;this.stats=null}function t(b,c,g){var h=A.pop()||new d;h.startQueryIndex=b;h.endQueryIndex=c;h.sum=0;h.stats=g;p.push(h)}var h=k.ext_disjoint_timer_query;if(!h)return null;var m=[],b=[],A=[],p=[],z=[],g=[];return{beginQuery:function(c){var d=m.pop()||h.createQueryEXT();h.beginQueryEXT(35007,d);b.push(d);t(b.length-1,b.length,c)},endQuery:function(){h.endQueryEXT(35007)},
pushScopeStats:t,update:function(){var c,d;c=b.length;if(0!==c){g.length=Math.max(g.length,c+1);z.length=Math.max(z.length,c+1);z[0]=0;var k=g[0]=0;for(d=c=0;d<b.length;++d){var r=b[d];h.getQueryObjectEXT(r,34919)?(k+=h.getQueryObjectEXT(r,34918),m.push(r)):b[c++]=r;z[d+1]=k;g[d+1]=c}b.length=c;for(d=c=0;d<p.length;++d){var k=p[d],t=k.startQueryIndex,r=k.endQueryIndex;k.sum+=z[r]-z[t];t=g[t];r=g[r];r===t?(k.stats.gpuTime+=k.sum/1E6,A.push(k)):(k.startQueryIndex=t,k.endQueryIndex=r,p[c++]=k)}p.length=
c}},getNumPendingQueries:function(){return b.length},clear:function(){m.push.apply(m,b);for(var c=0;c<m.length;c++)h.deleteQueryEXT(m[c]);b.length=0;m.length=0},restore:function(){b.length=0;m.length=0}}}},{}],23:[function(k,t,B){function c(a){return"undefined"!==typeof btoa?btoa(a):"base64:"+a}function r(a){a=Error("(regl) "+a);console.error(a);throw a;}function d(a,b){a||r(b)}function w(a){return a?": "+a:""}function h(a,b,c){0>b.indexOf(a)&&r("invalid value"+w(c)+". must be one of: "+b)}function m(a,
b){for(a+="";a.length<b;)a=" "+a;return a}function b(){this.name="unknown";this.lines=[];this.index={};this.hasErrors=!1}function A(a,b){this.number=a;this.line=b;this.errors=[]}function p(a,b,c){this.file=a;this.line=b;this.message=c}function z(){var a=Error(),a=(a.stack||a).toString(),b=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(a);return b?b[1]:(a=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(a))?a[1]:"unknown"}function g(){var a=Error(),a=(a.stack||a).toString(),b=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(a);
return b?b[1]:(a=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(a))?a[1]:"unknown"}function l(a,e){var d=a.split("\n"),g=1,f=0,h={unknown:new b,0:new b};h.unknown.name=h[0].name=e||z();h.unknown.lines.push(new A(0,""));for(var l=0;l<d.length;++l){var n=d[l],m=/^\s*\#\s*(\w+)\s+(.+)\s*$/.exec(n);if(m)switch(m[1]){case "line":if(m=/(\d+)(\s+\d+)?/.exec(m[2]))g=m[1]|0,m[2]&&(f=m[2]|0,f in h||(h[f]=new b));break;case "define":if(m=/SHADER_NAME(_B64)?\s+(.*)$/.exec(m[2]))h[f].name=m[1]?c(m[2]):m[2]}h[f].lines.push(new A(g++,
n))}Object.keys(h).forEach(function(a){var b=h[a];b.lines.forEach(function(a){b.index[a.number]=a})});return h}function n(a){var b=[];a.split("\n").forEach(function(a){if(!(5>a.length)){var c=/^ERROR\:\s+(\d+)\:(\d+)\:\s*(.*)$/.exec(a);c?b.push(new p(c[1]|0,c[2]|0,c[3].trim())):0<a.length&&b.push(new p("unknown",0,a))}});return b}function I(a,b){b.forEach(function(b){var c=a[b.file];if(c){var e=c.index[b.line];if(e){e.errors.push(b);c.hasErrors=!0;return}}a.unknown.hasErrors=!0;a.unknown.lines[0].errors.push(b)})}
function K(a){a._commandRef=z()}function F(a,b){var c=g();r(a+" in command "+(b||z())+("unknown"===c?"":" called from "+c))}function y(a,b,c,d){typeof a!==b&&F("invalid parameter type"+w(c)+". expected "+b+", got "+typeof a,d||z())}function u(a,b){return 32820===a||32819===a||33635===a?2:34042===a?4:f[a]*b}var D=k("./is-typed-array");k=k("./extend");var G="gl canvas container attributes pixelRatio extensions optionalExtensions profile onDone".split(" "),f={};f[5120]=f[5121]=1;f[5122]=f[5123]=f[36193]=
f[33635]=f[32819]=f[32820]=2;f[5124]=f[5125]=f[5126]=f[34042]=4;t.exports=k(d,{optional:function(a){a()},raise:r,commandRaise:F,command:function(a,b,c){a||F(b,c||z())},parameter:function(a,b,c){a in b||r("unknown parameter ("+a+")"+w(c)+". possible values: "+Object.keys(b).join())},commandParameter:function(a,b,c,d){a in b||F("unknown parameter ("+a+")"+w(c)+". possible values: "+Object.keys(b).join(),d||z())},constructor:function(a){Object.keys(a).forEach(function(a){0>G.indexOf(a)&&r('invalid regl constructor argument "'+
a+'". must be one of '+G)})},type:function(a,b,c){typeof a!==b&&r("invalid parameter type"+w(c)+". expected "+b+", got "+typeof a)},commandType:y,isTypedArray:function(a,b){D(a)||r("invalid parameter type"+w(b)+". must be a typed array")},nni:function(a,b){0<=a&&(a|0)===a||r("invalid parameter type, ("+a+")"+w(b)+". must be a nonnegative integer")},oneOf:h,shaderError:function(a,b,c,g,f){if(!a.getShaderParameter(b,a.COMPILE_STATUS)){b=a.getShaderInfoLog(b);a=g===a.FRAGMENT_SHADER?"fragment":"vertex";
y(c,"string",a+" shader source must be a string",f);var h=l(c,f);c=n(b);I(h,c);Object.keys(h).forEach(function(a){function b(a,c){e.push(a);d.push(c||"")}var c=h[a];if(c.hasErrors){var e=[""],d=[""];b("file number "+a+": "+c.name+"\n","color:red;text-decoration:underline;font-weight:bold");c.lines.forEach(function(a){if(0<a.errors.length){b(m(a.number,4)+"|  ","background-color:yellow; font-weight:bold");b(a.line+"\n","color:red; background-color:yellow; font-weight:bold");var c=0;a.errors.forEach(function(e){e=
e.message;var d=/^\s*\'(.*)\'\s*\:\s*(.*)$/.exec(e);if(d){var f=d[1];e=d[2];switch(f){case "assign":f="="}c=Math.max(a.line.indexOf(f,c),0)}else c=0;b(m("| ",6));b(m("^^^",c+3)+"\n","font-weight:bold");b(m("| ",6));b(e+"\n","font-weight:bold")});b(m("| ",6)+"\n")}else b(m(a.number,4)+"|  "),b(a.line+"\n","color:red")});"undefined"!==typeof document?(d[0]=e.join("%c"),console.log.apply(console,d)):console.log(e.join(""))}});d.raise("Error compiling "+a+" shader, "+h[0].name)}},linkError:function(a,
b,c,f,g){a.getProgramParameter(b,a.LINK_STATUS)||(a=a.getProgramInfoLog(b),c=l(c,g),f='Error linking program with vertex shader, "'+l(f,g)[0].name+'", and fragment shader "'+c[0].name+'"',"undefined"!==typeof document?console.log("%c"+f+"\n%c"+a,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(f+"\n"+a),d.raise(f))},callSite:g,saveCommandRef:K,saveDrawInfo:function(a,b,c,d){function f(a){return a?d.id(a):0}function g(a,b){Object.keys(b).forEach(function(b){a[d.id(b)]=
!0})}K(a);a._fragId=f(a["static"].frag);a._vertId=f(a["static"].vert);var h=a._uniformSet={};g(h,b["static"]);g(h,b.dynamic);b=a._attributeSet={};g(b,c["static"]);g(b,c.dynamic);a._hasCount="count"in a["static"]||"count"in a.dynamic||"elements"in a["static"]||"elements"in a.dynamic},framebufferFormat:function(a,b,c){a.texture?h(a.texture._texture.internalformat,b,"unsupported texture format for attachment"):h(a.renderbuffer._renderbuffer.format,c,"unsupported renderbuffer format for attachment")},
guessCommand:z,texture2D:function(a,b,c){var f=b.width,g=b.height,h=b.channels;d(0<f&&f<=c.maxTextureSize&&0<g&&g<=c.maxTextureSize,"invalid texture shape");33071===a.wrapS&&33071===a.wrapT||d(!(f&f-1)&&!!f&&!(g&g-1)&&!!g,"incompatible wrap mode for texture, both width and height must be power of 2");1===b.mipmask?1!==f&&1!==g&&d(9984!==a.minFilter&&9986!==a.minFilter&&9985!==a.minFilter&&9987!==a.minFilter,"min filter requires mipmap"):(d(!(f&f-1)&&!!f&&!(g&g-1)&&!!g,"texture must be a square power of 2 to support mipmapping"),
d(b.mipmask===(f<<1)-1,"missing or incomplete mipmap data"));5126===b.type&&(0>c.extensions.indexOf("oes_texture_float_linear")&&d(9728===a.minFilter&&9728===a.magFilter,"filter not supported, must enable oes_texture_float_linear"),d(!a.genMipmaps,"mipmap generation not supported with float textures"));var l=b.images;for(c=0;16>c;++c)if(l[c]){var n=f>>c,m=g>>c;d(b.mipmask&1<<c,"missing mipmap data");var p=l[c];d(p.width===n&&p.height===m,"invalid shape for mip images");d(p.format===b.format&&p.internalformat===
b.internalformat&&p.type===b.type,"incompatible type for mip image");p.compressed||p.data&&d(p.data.byteLength===n*m*Math.max(u(p.type,h),p.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}else a.genMipmaps||d(0===(b.mipmask&1<<c),"extra mipmap data");b.compressed&&d(!a.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(a,b,c,f){var g=a.width,h=a.height,l=a.channels;d(0<g&&g<=f.maxTextureSize&&0<h&&h<=f.maxTextureSize,
"invalid texture shape");d(g===h,"cube map must be square");d(33071===b.wrapS&&33071===b.wrapT,"wrap mode not supported by cube map");for(f=0;f<c.length;++f){var n=c[f];d(n.width===g&&n.height===h,"inconsistent cube map face shape");b.genMipmaps&&(d(!n.compressed,"can not generate mipmap for compressed textures"),d(1===n.mipmask,"can not specify mipmaps and generate mipmaps"));for(var m=n.images,p=0;16>p;++p){var k=m[p];if(k){var r=g>>p,t=h>>p;d(n.mipmask&1<<p,"missing mipmap data");d(k.width===r&&
k.height===t,"invalid shape for mip images");d(k.format===a.format&&k.internalformat===a.internalformat&&k.type===a.type,"incompatible type for mip image");k.compressed||k.data&&d(k.data.byteLength===r*t*Math.max(u(k.type,l),k.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format")}}}}})},{"./extend":26,"./is-typed-array":29}],24:[function(k,t,B){t.exports="undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date}},
{}],25:[function(k,t,B){function c(c){return Array.prototype.slice.call(c)}function r(d){return c(d).join("")}var d=k("./extend");t.exports=function(){function k(){var b=[],h=[];return d(function(){b.push.apply(b,c(arguments))},{def:function(){var d="v"+m++;h.push(d);0<arguments.length&&(b.push(d,"="),b.push.apply(b,c(arguments)),b.push(";"));return d},toString:function(){return r([0<h.length?"var "+h+";":"",r(b)])}})}function h(){function b(c,d){n(c,d,"=",h.def(c,d),";")}var h=k(),n=k(),m=h.toString,
p=n.toString;return d(function(){h.apply(h,c(arguments))},{def:h.def,entry:h,exit:n,save:b,set:function(c,d,n){b(c,d);h(c,d,"=",n,";")},toString:function(){return m()+p()}})}var m=0,b=[],t=[],p=k(),z={};return{global:p,link:function(c){for(var d=0;d<t.length;++d)if(t[d]===c)return b[d];d="g"+m++;b.push(d);t.push(c);return d},block:k,proc:function(b,c){function n(){var b="a"+m.length;m.push(b);return b}var m=[];c=c||0;for(var p=0;p<c;++p)n();var p=h(),k=p.toString;return z[b]=d(p,{arg:n,toString:function(){return r(["function(",
m.join(),"){",k(),"}"])}})},scope:h,cond:function(){var b=r(arguments),l=h(),n=h(),m=l.toString,p=n.toString;return d(l,{then:function(){l.apply(l,c(arguments));return this},"else":function(){n.apply(n,c(arguments));return this},toString:function(){var c=p();c&&(c="else{"+c+"}");return r(["if(",b,"){",m(),"}",c])}})},compile:function(){var c=['"use strict";',p,"return {"];Object.keys(z).forEach(function(b){c.push('"',b,'":',z[b].toString(),",")});c.push("}");var d=r(c).replace(/;/g,";\n").replace(/}/g,
"}\n").replace(/{/g,"{\n");return Function.apply(null,b.concat(d)).apply(null,t)}}}},{"./extend":26}],26:[function(k,t,B){t.exports=function(c,k){for(var d=Object.keys(k),t=0;t<d.length;++t)c[d[t]]=k[d[t]];return c}},{}],27:[function(k,t,B){var c=k("./is-typed-array");t.exports=function(k){return Array.isArray(k)||c(k)}},{"./is-typed-array":29}],28:[function(k,t,B){var c=k("./is-typed-array");t.exports=function(k){return!!k&&"object"===typeof k&&Array.isArray(k.shape)&&Array.isArray(k.stride)&&"number"===
typeof k.offset&&k.shape.length===k.stride.length&&(Array.isArray(k.data)||c(k.data))}},{"./is-typed-array":29}],29:[function(k,t,B){var c=k("../constants/arraytypes.json");t.exports=function(k){return Object.prototype.toString.call(k)in c}},{"../constants/arraytypes.json":6}],30:[function(k,t,B){t.exports=function(c,k){for(var d=Array(c),t=0;t<c;++t)d[t]=k(t);return d}},{}],31:[function(k,t,B){function c(c){var d,b;d=(65535<c)<<4;c>>>=d;b=(255<c)<<3;c>>>=b;d|=b;b=(15<c)<<2;c>>>=b;d|=b;b=(3<c)<<1;
return d|b|c>>>b>>1}function r(d){a:{for(var m=16;268435456>=m;m*=16)if(d<=m){d=m;break a}d=0}m=w[c(d)>>2];return 0<m.length?m.pop():new ArrayBuffer(d)}function d(d){w[c(d.byteLength)>>2].push(d)}var w=k("./loop")(8,function(){return[]});t.exports={alloc:r,free:d,allocType:function(c,d){var b;switch(c){case 5120:b=new Int8Array(r(d),0,d);break;case 5121:b=new Uint8Array(r(d),0,d);break;case 5122:b=new Int16Array(r(2*d),0,d);break;case 5123:b=new Uint16Array(r(2*d),0,d);break;case 5124:b=new Int32Array(r(4*
d),0,d);break;case 5125:b=new Uint32Array(r(4*d),0,d);break;case 5126:b=new Float32Array(r(4*d),0,d);break;default:return null}return b.length!==d?b.subarray(0,d):b},freeType:function(c){d(c.buffer)}}},{"./loop":30}],32:[function(k,t,B){t.exports="function"===typeof requestAnimationFrame&&"function"===typeof cancelAnimationFrame?{next:function(c){return requestAnimationFrame(c)},cancel:function(c){return cancelAnimationFrame(c)}}:{next:function(c){return setTimeout(c,16)},cancel:clearTimeout}},{}],
33:[function(k,t,B){var c=k("./pool"),r=new Float32Array(1),d=new Uint32Array(r.buffer);t.exports=function(k){for(var h=c.allocType(5123,k.length),m=0;m<k.length;++m)if(isNaN(k[m]))h[m]=65535;else if(Infinity===k[m])h[m]=31744;else if(-Infinity===k[m])h[m]=64512;else{r[0]=k[m];var b=d[0],t=b>>>31<<15,p=(b<<1>>>24)-127,b=b>>13&1023;h[m]=-24>p?t:-14>p?t+(b+1024>>-14-p):15<p?t+31744:t+(p+15<<10)+b}return h}},{"./pool":31}],34:[function(k,t,B){t.exports=function(c){return Object.keys(c).map(function(k){return c[k]})}},
{}],35:[function(k,t,B){function c(b,c,d){function h(){var c=window.innerWidth,n=window.innerHeight;b!==document.body&&(n=b.getBoundingClientRect(),c=n.right-n.left,n=n.top-n.bottom);g.width=d*c;g.height=d*n;m(g.style,{width:c+"px",height:n+"px"})}var g=document.createElement("canvas");m(g.style,{border:0,margin:0,padding:0,top:0,left:0});b.appendChild(g);b===document.body&&(g.style.position="absolute",m(b.style,{margin:0,padding:0}));window.addEventListener("resize",h,!1);h();return{canvas:g,onDestroy:function(){window.removeEventListener("resize",
h);b.removeChild(g)}}}function r(b,c){function d(h){try{return b.getContext(h,c)}catch(g){return null}}return d("webgl")||d("experimental-webgl")||d("webgl-experimental")}function d(b){if("string"===typeof b)return b.split();h(Array.isArray(b),"invalid extension array");return b}function w(b){return"string"===typeof b?(h("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(b)):b}var h=k("./util/check"),m=k("./util/extend");t.exports=function(b){var k=b||{},p,m,g,l;
b={};var n=[],t=[],B="undefined"===typeof window?1:window.devicePixelRatio,F=!1,y=function(b){b&&h.raise(b)},u=function(){};"string"===typeof k?(h("undefined"!==typeof document,"selector queries only supported in DOM enviroments"),p=document.querySelector(k),h(p,"invalid query string for element")):"object"===typeof k?"string"===typeof k.nodeName&&"function"===typeof k.appendChild&&"function"===typeof k.getBoundingClientRect?p=k:"function"===typeof k.drawArrays||"function"===typeof k.drawElements?
(l=k,g=l.canvas):(h.constructor(k),"gl"in k?l=k.gl:"canvas"in k?g=w(k.canvas):"container"in k&&(m=w(k.container)),"attributes"in k&&(b=k.attributes,h.type(b,"object","invalid context attributes")),"extensions"in k&&(n=d(k.extensions)),"optionalExtensions"in k&&(t=d(k.optionalExtensions)),"onDone"in k&&(h.type(k.onDone,"function","invalid or missing onDone callback"),y=k.onDone),"profile"in k&&(F=!!k.profile),"pixelRatio"in k&&(B=+k.pixelRatio,h(0<B,"invalid pixel ratio"))):h.raise("invalid arguments to regl");
p&&("canvas"===p.nodeName.toLowerCase()?g=p:m=p);if(!l){if(!g){h("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");p=c(m||document.body,y,B);if(!p)return null;g=p.canvas;u=p.onDestroy}l=r(g,b)}return l?{gl:l,canvas:g,container:m,extensions:n,optionalExtensions:t,pixelRatio:B,profile:F,onDone:y,onDestroy:u}:(u(),y("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}},{"./util/check":23,"./util/extend":26}],
36:[function(k,t,B){t.exports=function(c){for(var k=Array(c),d=0;d<c;++d)k[d]=d;return k}},{}],37:[function(k,t,B){t.exports=function(c){return!(null==c||!(c._isBuffer||c.constructor&&"function"===typeof c.constructor.isBuffer&&c.constructor.isBuffer(c)))}},{}],38:[function(k,t,B){function c(b,c){return b[0]-c[0]}function r(){var b=this.stride,d=Array(b.length),g;for(g=0;g<d.length;++g)d[g]=[Math.abs(b[g]),g];d.sort(c);b=Array(d.length);for(g=0;g<b.length;++g)b[g]=d[g][1];return b}function d(b,c){var d=
["View",c,"d",b].join("");0>c&&(d="View_Nil"+b);var l="generic"===b;if(-1===c){var k,d=new Function("function "+d+"(a){this.data=a;};var proto="+d+".prototype;proto.dtype='"+b+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+d+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+d+"(a){return new "+d+"(a);}");return d()}if(0===
c)return d=new Function("TrivialArray","function "+d+"(a,d) {this.data = a;this.offset = d};var proto="+d+".prototype;proto.dtype='"+b+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+d+"_copy() {return new "+d+"(this.data,this.offset)};proto.pick=function "+d+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+d+"_get(){return "+(l?"this.data.get(this.offset)":
"this.data[this.offset]")+"};proto.set=function "+d+"_set(v){return "+(l?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+d+"(a,b,c,d){return new "+d+"(a,d)}"),d(A[b][0]);k=["'use strict'"];var m=h(c),t=m.map(function(b){return"i"+b}),w="this.offset+"+m.map(function(b){return"this.stride["+b+"]*i"+b}).join("+"),y=m.map(function(b){return"b"+b}).join(","),u=m.map(function(b){return"c"+b}).join(",");k.push("function "+d+"(a,"+y+","+u+",d){this.data=a","this.shape=["+
y+"]","this.stride=["+u+"]","this.offset=d|0}","var proto="+d+".prototype","proto.dtype='"+b+"'","proto.dimension="+c);k.push("Object.defineProperty(proto,'size',{get:function "+d+"_size(){return "+m.map(function(b){return"this.shape["+b+"]"}).join("*"),"}})");1===c?k.push("proto.order=[0]"):(k.push("Object.defineProperty(proto,'order',{get:"),4>c?(k.push("function "+d+"_order(){"),2===c?k.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===c&&k.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):
k.push("ORDER})"));k.push("proto.set=function "+d+"_set("+t.join(",")+",v){");l?k.push("return this.data.set("+w+",v)}"):k.push("return this.data["+w+"]=v}");k.push("proto.get=function "+d+"_get("+t.join(",")+"){");l?k.push("return this.data.get("+w+")}"):k.push("return this.data["+w+"]}");k.push("proto.index=function "+d+"_index(",t.join(),"){return "+w+"}");k.push("proto.hi=function "+d+"_hi("+t.join(",")+"){return new "+d+"(this.data,"+m.map(function(b){return["(typeof i",b,"!=='number'||i",b,
"<0)?this.shape[",b,"]:i",b,"|0"].join("")}).join(",")+","+m.map(function(b){return"this.stride["+b+"]"}).join(",")+",this.offset)}");l=m.map(function(b){return"a"+b+"=this.shape["+b+"]"});w=m.map(function(b){return"c"+b+"=this.stride["+b+"]"});k.push("proto.lo=function "+d+"_lo("+t.join(",")+"){var b=this.offset,d=0,"+l.join(",")+","+w.join(","));for(l=0;l<c;++l)k.push("if(typeof i"+l+"==='number'&&i"+l+">=0){d=i"+l+"|0;b+=c"+l+"*d;a"+l+"-=d}");k.push("return new "+d+"(this.data,"+m.map(function(b){return"a"+
b}).join(",")+","+m.map(function(b){return"c"+b}).join(",")+",b)}");k.push("proto.step=function "+d+"_step("+t.join(",")+"){var "+m.map(function(b){return"a"+b+"=this.shape["+b+"]"}).join(",")+","+m.map(function(b){return"b"+b+"=this.stride["+b+"]"}).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(l=0;l<c;++l)k.push("if(typeof i"+l+"==='number'){d=i"+l+"|0;if(d<0){c+=b"+l+"*(a"+l+"-1);a"+l+"=ceil(-a"+l+"/d)}else{a"+l+"=ceil(a"+l+"/d)}b"+l+"*=d}");k.push("return new "+d+"(this.data,"+m.map(function(b){return"a"+
b}).join(",")+","+m.map(function(b){return"b"+b}).join(",")+",c)}");w=Array(c);y=Array(c);for(l=0;l<c;++l)w[l]="a[i"+l+"]",y[l]="b[i"+l+"]";k.push("proto.transpose=function "+d+"_transpose("+t+"){"+t.map(function(b,c){return b+"=("+b+"===undefined?"+c+":"+b+"|0)"}).join(";"),"var a=this.shape,b=this.stride;return new "+d+"(this.data,"+w.join(",")+","+y.join(",")+",this.offset)}");k.push("proto.pick=function "+d+"_pick("+t+"){var a=[],b=[],c=this.offset");for(l=0;l<c;++l)k.push("if(typeof i"+l+"==='number'&&i"+
l+">=0){c=(c+this.stride["+l+"]*i"+l+")|0}else{a.push(this.shape["+l+"]);b.push(this.stride["+l+"])}");k.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}");k.push("return function construct_"+d+"(data,shape,stride,offset){return new "+d+"(data,"+m.map(function(b){return"shape["+b+"]"}).join(",")+","+m.map(function(b){return"stride["+b+"]"}).join(",")+",offset)}");d=new Function("CTOR_LIST","ORDER",k.join("\n"));return d(A[b],r)}function w(c){if(m(c))return"buffer";if(b)switch(Object.prototype.toString.call(c)){case "[object Float64Array]":return"float64";
case "[object Float32Array]":return"float32";case "[object Int8Array]":return"int8";case "[object Int16Array]":return"int16";case "[object Int32Array]":return"int32";case "[object Uint8Array]":return"uint8";case "[object Uint16Array]":return"uint16";case "[object Uint32Array]":return"uint32";case "[object Uint8ClampedArray]":return"uint8_clamped"}return Array.isArray(c)?"array":"generic"}var h=k("iota-array"),m=k("is-buffer"),b="undefined"!==typeof Float64Array,A={float32:[],float64:[],int8:[],int16:[],
int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],buffer:[],generic:[]};(function(){for(var b in A)A[b].push(d(b,-1))});t.exports=function(b,c,g,h){if(void 0===b){var k=A.array[0];return k([])}"number"===typeof b&&(b=[b]);void 0===c&&(c=[b.length]);k=c.length;if(void 0===g){g=Array(k);for(var m=k-1,r=1;0<=m;--m)g[m]=r,r*=c[m]}if(void 0===h)for(m=h=0;m<k;++m)0>g[m]&&(h-=(c[m]-1)*g[m]);m=w(b);for(r=A[m];r.length<=k+1;)r.push(d(m,r.length-1));k=r[k+1];return k(b,c,g,h)}},{"iota-array":36,
"is-buffer":37}],39:[function(k,t,B){function c(b){throw Error("resl: "+b);}function r(b,d,h){Object.keys(b).forEach(function(b){0>d.indexOf(b)&&c('invalid parameter "'+b+'" in '+h)})}function d(b,c){this.state=0;this.ready=!1;this.progress=0;this.name=b;this.cancel=c}var w=["manifest","onDone","onProgress","onError"],h=["type","src","stream","credentials","parser"],m=["onData","onDone"];t.exports=function(b){function k(d,a){if(d in b){var e=b[d];"function"!==typeof e&&c('invalid callback "'+d+'"');
return e}return null}function p(b){function a(){if(!(2>n.readyState||1===r.state||-1===r.state)){if(200!==n.status)return g('error loading resource "'+b.name+'"');if(2<n.readyState&&0===r.state){var a;a="binary"===b.type?n.response:n.responseText;if(m.data)try{p=m.data(a)}catch(d){return g(d)}else p=a}if(3<n.readyState&&0===r.state){if(m.done)try{p=m.done()}catch(d){return g(d)}r.state=1}y[c]=p;r.progress=.75*r.progress+.25;r.ready=b.stream&&!!p||1===r.state;l()}}var c=b.name,h=b.stream,k="binary"===
b.type,m=b.parser,n=new XMLHttpRequest,p=null,r=new d(c,function(){1!==r.state&&-1!==r.state&&(n.onreadystatechange=null,n.abort(),r.state=-1)});n.onreadystatechange=h?a:function(){4===n.readyState&&a()};k&&(n.responseType="arraybuffer");b.credentials&&(n.withCredentials=!0);n.open("GET",b.src,!0);n.send();return r}function t(b,a){function c(){if(0===u.state)if(r.data)try{w=r.data(a)}catch(b){return g(b)}else w=a}function h(a){c();y[p]=w;u.progress=a.lengthComputable?Math.max(u.progress,a.loaded/
a.total):.75*u.progress+.25;u.ready=b.stream;l(p)}function k(){c();if(0===u.state){if(r.done)try{w=r.done()}catch(a){return g(a)}u.state=1}u.progress=1;u.ready=!0;y[p]=w;n();l("finish "+p)}function m(){g('error loading asset "'+p+'"')}function n(){b.stream&&a.removeEventListener("progress",h);"image"===b.type?a.addEventListener("load",k):a.addEventListener("canplay",k);a.removeEventListener("error",m)}var p=b.name,r=b.parser,u=new d(p,function(){1!==u.state&&-1!==u.state&&(u.state=-1,n(),a.src="")}),
w=a;b.stream&&a.addEventListener("progress",h);"image"===b.type?a.addEventListener("load",k):a.addEventListener("canplay",k);a.addEventListener("error",m);a.crossOrigin=b.credentials?"use-credentials":"anonymous";a.src=b.src;return u}function g(b){-1!==u&&1!==u&&(u=-1,G.forEach(function(a){a.cancel()}),F?"string"===typeof b?F(Error("resl: "+b)):F(b):console.error("resl error:",b))}function l(b){if(-1!==u&&1!==u){var a=0,c=0;G.forEach(function(b){b.ready&&(c+=1);a+=b.progress});c===G.length?(u=1,B(y)):
K&&K(a/G.length,b)}}"object"===typeof b&&b||c("invalid or missing configuration");r(b,w,"config");var n=b.manifest;"object"===typeof n&&n||c("missing manifest");var B=k("onDone");B||c("missing onDone() callback");var K=k("onProgress"),F=k("onError"),y={},u=0,D={text:p,binary:function(b){return p(b)},image:function(b){return t(b,document.createElement("img"))},video:function(b){return t(b,document.createElement("video"))},audio:function(b){return t(b,document.createElement("audio"))}},G=Object.keys(n).map(function(b){function a(a,
b){if(a in d.parser){var f=d.parser[a];"function"!==typeof f&&c("invalid parser callback "+a+' for asset "'+a+'"');return f}return b}var d=n[b];"string"===typeof d?d={src:d}:"object"===typeof d&&d||c('invalid asset definition "'+b+'"');r(d,h,'asset "'+b+'"');var g={};"parser"in d&&("function"===typeof d.parser?g={data:d.parser}:"object"===typeof d.parser&&d.parser?(r(g,m,'parser for asset "'+b+'"'),"onData"in g||c('missing onData callback for parser in asset "'+b+'"'),g={data:a("onData"),done:a("onDone")}):
c('invalid parser for asset "'+b+'"'));return{name:b,type:function(a,g,h){a in d&&(h=d[a]);0>g.indexOf(h)&&c("invalid "+a+' "'+h+'" for asset "'+b+'", possible values: '+g);return h}("type",Object.keys(D),"text"),stream:!!d.stream,credentials:!!d.credentials,src:function(a,g,h){a in d?h=d[a]:g&&c("missing "+a+' for asset "'+b+'"');"string"!==typeof h&&c("invalid "+a+' for asset "'+b+'", must be a string');return h}("src",!0,""),parser:g}}).map(function(b){return D[b.type](b)})}},{}],40:[function(k,
t,B){function c(c){switch(c){case "uint8":return Uint8Array;case "uint16":return Uint16Array;case "uint32":return Uint32Array;case "int8":return Int8Array;case "int16":return Int16Array;case "int32":return Int32Array;case "float":case "float32":return Float32Array;case "double":case "float64":return Float64Array;case "uint8_clamped":return Uint8ClampedArray;case "generic":case "buffer":case "data":case "dataview":return ArrayBuffer;case "array":return Array}}var r=k("ndarray");t.exports=function(d,
k){for(var h=1,m=0;m<d.length;++m)h*=d[m];return r(new (c(k||"float64"))(h),d)}},{ndarray:38}],41:[function(k,t,B){function c(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var r=k("./lib/util/check"),d=k("./lib/util/extend"),w=k("./lib/dynamic"),h=k("./lib/util/raf"),m=k("./lib/util/clock"),b=k("./lib/strings"),A=k("./lib/webgl"),p=k("./lib/extension"),z=k("./lib/limits"),g=k("./lib/buffer"),l=k("./lib/elements"),n=k("./lib/texture"),I=k("./lib/renderbuffer"),K=k("./lib/framebuffer"),
F=k("./lib/attribute"),y=k("./lib/shader"),u=k("./lib/read"),D=k("./lib/core"),G=k("./lib/stats"),f=k("./lib/timer");t.exports=function(a){function e(){if(0===H.length)P&&P.update(),fa=null;else{fa=h.next(e);La();for(var a=H.length-1;0<=a;--a){var b=H[a];b&&b(Y,null,0)}v.flush();P&&P.update()}}function k(){!fa&&0<H.length&&(fa=h.next(e))}function t(){fa&&(h.cancel(e),fa=null)}function B(a){a.preventDefault();ia=!0;t();ba.forEach(function(a){a()})}function N(a){v.getError();ia=!1;ra.restore();ma.restore();
ka.restore();pa.restore();ta.restore();X.restore();P&&P.restore();ea.procs.refresh();k();aa.forEach(function(a){a()})}function V(a){function b(a){var c={},d={};Object.keys(a).forEach(function(b){var e=a[b];w.isDynamic(e)?d[b]=w.unbox(e,b):c[b]=e});return{dynamic:d,"static":c}}function c(a){for(;n.length<a;)n.push(null);return n}r(!!a,"invalid args to regl({...})");r.type(a,"object","invalid args to regl({...})");var e=b(a.context||{}),f=b(a.uniforms||{}),g=b(a.attributes||{}),h=b(function(a){function b(a){if(a in
c){var d=c[a];delete c[a];Object.keys(d).forEach(function(b){c[a+"."+b]=d[b]})}}var c=d({},a);delete c.uniforms;delete c.attributes;delete c.context;"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op);b("blend");b("depth");b("cull");b("stencil");b("polygonOffset");b("scissor");b("sample");return c}(a));a={gpuTime:0,cpuTime:0,count:0};var e=ea.compile(h,g,f,e,a),k=e.draw,l=e.batch,m=e.scope,n=[];return d(function(a,b){var d;ia&&r.raise("context lost");
if("function"===typeof a)return m.call(this,null,a,0);if("function"===typeof b)if("number"===typeof a)for(d=0;d<a;++d)m.call(this,null,b,d);else if(Array.isArray(a))for(d=0;d<a.length;++d)m.call(this,a[d],b,d);else return m.call(this,a,b,0);else if("number"===typeof a){if(0<a)return l.call(this,c(a|0),a|0)}else if(Array.isArray(a)){if(a.length)return l.call(this,a,a.length)}else return k.call(this,a)},{stats:a})}function O(a){r.type(a,"function","regl.frame() callback must be a function");H.push(a);
k();return{cancel:function(){function b(){var a=c(H,b);H[a]=H[H.length-1];--H.length;0>=H.length&&t()}var d=c(H,a);r(0<=d,"cannot cancel a frame twice");H[d]=b}}}function C(){var a=M.viewport,b=M.scissor_box;a[0]=a[1]=b[0]=b[1]=0;Y.viewportWidth=Y.framebufferWidth=Y.drawingBufferWidth=a[2]=b[2]=v.drawingBufferWidth;Y.viewportHeight=Y.framebufferHeight=Y.drawingBufferHeight=a[3]=b[3]=v.drawingBufferHeight}function La(){Y.tick+=1;Y.time=ca();C();ea.procs.poll()}function ha(){C();ea.procs.refresh();
P&&P.update()}function ca(){return(m()-T)/1E3}a=A(a);if(!a)return null;var v=a.gl,U=v.getContextAttributes(),ia=v.isContextLost(),ra=p(v,a);if(!ra)return null;var na=b(),da=G(),Q=ra.extensions,P=f(v,Q),T=m(),ja=v.drawingBufferWidth,sa=v.drawingBufferHeight,Y={tick:0,time:0,viewportWidth:ja,viewportHeight:sa,framebufferWidth:ja,framebufferHeight:sa,drawingBufferWidth:ja,drawingBufferHeight:sa,pixelRatio:a.pixelRatio},ga=z(v,Q),ka=g(v,da,a),la=l(v,Q,ka,da),ja=F(v,Q,ga,ka,na),ma=y(v,na,da,a),pa=n(v,
Q,ga,function(){ea.procs.poll()},Y,da,a),ta=I(v,Q,ga,da,a),X=K(v,Q,ga,pa,ta,da),ea=D(v,na,Q,ga,ka,la,pa,X,{},ja,ma,{elements:null,primitive:4,count:-1,offset:0,instances:-1},Y,P,a),na=u(v,X,ea.procs.poll,Y,U,Q),M=ea.next,Z=v.canvas,H=[],ba=[],aa=[],ua=[a.onDestroy],fa=null;Z&&(Z.addEventListener("webglcontextlost",B,!1),Z.addEventListener("webglcontextrestored",N,!1));ha();U=d(V,{clear:function(a){r("object"===typeof a&&a,"regl.clear() takes an object as input");var b=0;ea.procs.poll();var c=a.color;
c&&(v.clearColor(+c[0]||0,+c[1]||0,+c[2]||0,+c[3]||0),b|=16384);"depth"in a&&(v.clearDepth(+a.depth),b|=256);"stencil"in a&&(v.clearStencil(a.stencil|0),b|=1024);r(!!b,"called regl.clear with no buffer specified");v.clear(b)},prop:w.define.bind(null,1),context:w.define.bind(null,2),"this":w.define.bind(null,3),draw:V({}),buffer:function(a){return ka.create(a,34962,!1,!1)},elements:function(a){return la.create(a,!1)},texture:pa.create2D,cube:pa.createCube,renderbuffer:ta.create,framebuffer:X.create,
framebufferCube:X.createCube,attributes:U,frame:O,on:function(a,b){r.type(b,"function","listener callback must be a function");var c;switch(a){case "frame":return O(b);case "lost":c=ba;break;case "restore":c=aa;break;case "destroy":c=ua;break;default:r.raise("invalid event, must be one of frame,lost,restore,destroy")}c.push(b);return{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1];c.pop();break}}}},limits:ga,hasExtension:function(a){return 0<=ga.extensions.indexOf(a.toLowerCase())},
read:na,destroy:function(){H.length=0;t();Z&&(Z.removeEventListener("webglcontextlost",B),Z.removeEventListener("webglcontextrestored",N));ma.clear();X.clear();ta.clear();pa.clear();la.clear();ka.clear();P&&P.clear();ua.forEach(function(a){a()})},_gl:v,_refresh:ha,poll:function(){La();P&&P.update()},now:ca,stats:da});a.onDone(null,U);return U}},{"./lib/attribute":4,"./lib/buffer":5,"./lib/core":10,"./lib/dynamic":11,"./lib/elements":12,"./lib/extension":13,"./lib/framebuffer":14,"./lib/limits":15,
"./lib/read":16,"./lib/renderbuffer":17,"./lib/shader":18,"./lib/stats":19,"./lib/strings":20,"./lib/texture":21,"./lib/timer":22,"./lib/util/check":23,"./lib/util/clock":24,"./lib/util/extend":26,"./lib/util/raf":32,"./lib/webgl":35}]},{},[2]);
